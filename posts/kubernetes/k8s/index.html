<!DOCTYPE html>
<html lang="zh-Hans"
  x-data
  :class="$store.darkMode.class()"
  :data-theme="$store.darkMode.theme()">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>K8s概述 | MoonLightMaze’s Blog</title>

    
  
    <link href="/favicon.ico" rel="icon" type="image/x-icon" />
  


<link rel="canonical" href="https://moonlightmazed.github.io/posts/kubernetes/k8s/" />



<meta name="author" content="MoonlightMaze" />
<meta name="description" content="Kubernetes（简称k8s）是Google在2014年6月开源的一个容器集群管理系统，使用Go语言开发，用于管理云平台中多个主机上的容器化的应用。" />


<meta name="keywords" content="K8s">



<meta name="generator" content="Hugo 0.145.0">


<meta property="og:url" content="https://moonlightmazed.github.io/posts/kubernetes/k8s/">
  <meta property="og:site_name" content="MoonLightMaze’s Blog">
  <meta property="og:title" content="K8s概述">
  <meta property="og:description" content="Kubernetes（简称k8s）是Google在2014年6月开源的一个容器集群管理系统，使用Go语言开发，用于管理云平台中多个主机上的容器化的应用。">
  <meta property="og:locale" content="zh_Hans">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2020-10-02T17:43:02+08:00">
    <meta property="article:modified_time" content="2024-05-12T13:43:02+08:00">
    <meta property="article:tag" content="K8s">
    <meta property="og:image" content="https://moonlightmazed.github.io/posts/kubernetes/k8s/image.png">




  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://moonlightmazed.github.io/posts/kubernetes/k8s/image.png">
  <meta name="twitter:title" content="K8s概述">
  <meta name="twitter:description" content="Kubernetes（简称k8s）是Google在2014年6月开源的一个容器集群管理系统，使用Go语言开发，用于管理云平台中多个主机上的容器化的应用。">




  

<link rel="stylesheet" href="/css/output.min.css" />




    


<style>
  pre {
    padding: 1em;
    overflow: auto;
  }
</style>









    

    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  </head>

  <body x-data="{
    flip: false,
  }">
    
    <div id="dream-global-bg"></div>

    
<nav class="mt-4 lg:mt-8 py-4">

  
  <div class="container flex justify-between px-4">
  
    <section class="flex items-center gap-4">
      <div class="avatar cursor-pointer hover:online" @click="flip = !flip" title="翻转一下！">
        <div class="h-10 rounded-full">
          <img src="/img/avatar.png" alt="MoonLightMaze’s Blog" />
        </div>
      </div>

      
      <div>
        
        <a href="https://moonlightmazed.github.io/" class="text-lg font-semibold cursor-pointer">
          MoonLightMaze’s Blog
        </a>
        
        
        <div class="text-base-content/60 text-sm">代码写的越急，程序跑得越慢</div>
        
      </div>
      
    </section>

    <div class="dropdown dropdown-end sm:hidden">
      <div tabindex="0" role="button" class="btn btn-ghost btn-square" aria-label="Select an option">
        <ion-icon name="menu" class="text-2xl"></ion-icon>
      </div>
      <ul tabindex="0" class="dropdown-content menu w-36 bg-base-100 rounded-box z-[1] shadow-md">
        








<li>
  <a class="inline-flex items-center p-2 cursor-pointer" href="/" target="" title="home">
    
    <ion-icon name="home"></ion-icon>
    
    home
  </a>
</li>





<li>
  <a class="inline-flex items-center p-2 cursor-pointer" href="/categories" title="所有分类">
    <ion-icon name="grid"></ion-icon>
    所有分类
  </a>
</li>




<li>
  <a class="inline-flex items-center p-2 cursor-pointer" href="/tags" title="所有标签">
    <ion-icon name="pricetags"></ion-icon>
    所有标签
  </a>
</li>




<li>
  <a class="inline-flex items-center p-2 cursor-pointer" href="/posts" title="归档">
    <ion-icon name="archive"></ion-icon>
    归档
  </a>
</li>




<li>
  <a class="group inline-flex items-center p-2 cursor-pointer" href="/search" title="搜索">
    <ion-icon name="search"></ion-icon>
    搜索
  </a>
</li>








<li>
  <div role="link" tabindex="0" class="inline-flex items-center p-2 cursor-pointer" @click="flip = !flip" title="关于">
    <ion-icon name="information-circle"></ion-icon>关于</div>
</li>










<li>
  <a class="inline-flex items-center p-2 cursor-pointer" href="https://github.com/moonlightmazed" target="_blank" title="GitHub">
    
    <ion-icon name="logo-github"></ion-icon>
    
    GitHub
  </a>
</li>





















      </ul>
    </div>
    <section class="hidden sm:flex sm:items-center sm:gap-2 md:gap-4">
      
      
        
      

      

      
      



  
  <a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="/" target="" title="home">
    <ion-icon class="group-hover:text-primary-content" name="home"></ion-icon>
  </a>
  



      
      
<a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="/categories" title="所有分类">
  <ion-icon class="group-hover:text-primary-content" name="grid"></ion-icon>
</a>


      
      
<a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="/tags" title="所有标签">
  <ion-icon class="group-hover:text-primary-content" name="pricetags"></ion-icon>
</a>


      
      
<a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="/posts" title="归档">
  <ion-icon class="group-hover:text-primary-content" name="archive"></ion-icon>
</a>


      
      
<a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="/search" title="搜索">
  <ion-icon class="group-hover:text-primary-content" name="search"></ion-icon>
</a>


      
      




<div role="link" tabindex="0" class="text-sm font-semibold cursor-pointer hover:underline" @click="flip = !flip" title="关于">关于</div>





      
      



  
  <a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="https://github.com/moonlightmazed" target="_blank" title="GitHub">
    <ion-icon class="group-hover:text-primary-content" name="logo-github"></ion-icon>
  </a>
  



      

      
      












      

      
    </section>
  </div>
</nav>


    <div class="flip-container" :class="{ 'flip-it': flip }">
      <div class="flipper">
        <div class="front">
          <div class="container">
            

<div class="lg:grid lg:grid-cols-5 gap-4 mt-4 px-4">
  
  <div class="lg:col-span-4">
    <article class="mx-auto prose prose-quoteless dark:prose-invert w-full" id="dream-single-post-main" itemscope
      itemtype="http://schema.org/Article" style="margin-right: 30px;max-width: 100% !important;width: 100% !important; ">
      
  <meta itemprop="name" content="K8s概述">
  <meta itemprop="description" content="Kubernetes（简称k8s）是Google在2014年6月开源的一个容器集群管理系统，使用Go语言开发，用于管理云平台中多个主机上的容器化的应用。">
  <meta itemprop="datePublished" content="2020-10-02T17:43:02+08:00">
  <meta itemprop="dateModified" content="2024-05-12T13:43:02+08:00">
  <meta itemprop="wordCount" content="9153">
  <meta itemprop="image" content="https://moonlightmazed.github.io/posts/kubernetes/k8s/image.png">
  <meta itemprop="keywords" content="K8s">

      <header>
        <h1 itemprop="headline">K8s概述</h1>
        <p class="text-sm">
          
          <span data-format="luxon">2020-10-02T17:43:02&#43;08:00</span>
          

          | <span>19分钟阅读</span>

          
          | <span>更新于
            
            <span data-format="luxon">2024-05-12T13:43:02&#43;08:00</span>
            </span>
          
        </p>

        
        <div class="flex justify-between">
          
          <div class="flex items-center">
  
  <span>@</span>
  

  <span itemprop="author" itemscope itemtype="https://schema.org/Person">
  
    
      <span itemprop="name">MoonlightMaze</span>
    
  
  </span>
</div>

          

          <div class="flex items-center gap-2">
  
  

  
  
  
</div>

        </div>
      </header>

      
      <section id="dream-single-post-content" itemprop="articleBody" class="w-full" style="margin-top: 40px !important;">
        

        <h1 id="kubernetes-解析">Kubernetes 解析</h1>
<h1 id="pod-解析">Pod 解析：</h1>
<h2 id="一pod-基础概念">一、Pod 基础概念</h2>
<h3 id="1-定义">1. 定义</h3>
<p>在 Kubernetes（K8s）里，Pod 属于最基础且最小的可部署单元。它代表一组紧密关联的容器集合，这些容器会共享存储、网络以及运行环境。可以把 Pod 当作是运行特定应用程序的一个“逻辑主机”。</p>
<h3 id="2-设计理念">2. 设计理念</h3>
<p>Pod 的设计是为了支持那些紧密耦合、相互协作的进程，这些进程可能会一起部署和管理。比如，一个主应用容器和一个用于日志收集的 Sidecar 容器就可以放在同一个 Pod 中。</p>
<h3 id="3-共享资源">3. 共享资源</h3>
<ul>
<li><strong>网络</strong>：Pod 内的所有容器共享同一个网络命名空间，拥有相同的 IP 地址和端口空间。这意味着容器之间可以通过 <code>localhost</code> 直接通信，极大地简化了应用内部的网络交互。</li>
<li><strong>存储</strong>：Pod 能够定义一个或多个存储卷（Volume），这些存储卷可被 Pod 内的所有容器访问，方便实现数据的持久化或者容器间的数据共享。</li>
</ul>
<h2 id="二pod-的生命周期">二、Pod 的生命周期</h2>
<h3 id="1-pending挂起">1. Pending（挂起）</h3>
<ul>
<li><strong>状态说明</strong>：当你创建一个 Pod 时，它首先会进入 Pending 状态。此时，Kubernetes API Server 已经接收到创建请求，但 Pod 还未被完全创建好。</li>
<li><strong>可能原因</strong>：
<ul>
<li>调度器还没为 Pod 分配合适的节点。</li>
<li>容器镜像正在下载，特别是大镜像时，下载时间可能较长。</li>
</ul>
</li>
</ul>
<h3 id="2-containercreating容器创建中">2. ContainerCreating（容器创建中）</h3>
<ul>
<li><strong>状态说明</strong>：一旦 Pod 被调度到某个节点，kubelet 就会开始创建容器。</li>
<li><strong>主要操作</strong>：
<ul>
<li>从镜像仓库下载容器镜像（如果本地不存在）。</li>
<li>创建容器的网络和存储等资源。</li>
<li>启动容器进程。</li>
</ul>
</li>
</ul>
<h3 id="3-running运行中">3. Running（运行中）</h3>
<ul>
<li><strong>状态说明</strong>：当 Pod 内的所有容器都成功创建并启动后，Pod 进入 Running 状态。不过，这并不意味着应用程序一定能正常工作，还需通过健康检查来确认。</li>
<li><strong>相关操作</strong>：此时，Pod 中的应用程序开始提供服务，并且可以接收外部流量。</li>
</ul>
<h3 id="4-succeeded成功">4. Succeeded（成功）</h3>
<ul>
<li><strong>状态说明</strong>：如果 Pod 中的所有容器都正常终止（退出码为 0），Pod 就会进入 Succeeded 状态。</li>
<li><strong>常见场景</strong>：这种情况常见于一次性任务，比如批处理作业，任务完成后容器就会正常退出。</li>
</ul>
<h3 id="5-failed失败">5. Failed（失败）</h3>
<ul>
<li><strong>状态说明</strong>：若 Pod 中的任何一个容器以非零退出码终止，或者在创建、运行过程中出现错误，Pod 就会进入 Failed 状态。</li>
<li><strong>可能原因</strong>：
<ul>
<li>镜像下载失败。</li>
<li>容器启动脚本出错。</li>
<li>应用程序内部错误。</li>
</ul>
</li>
</ul>
<h3 id="6-unknown未知">6. Unknown（未知）</h3>
<ul>
<li><strong>状态说明</strong>：当 kubelet 无法向 API Server 汇报 Pod 的状态时，Pod 会处于 Unknown 状态。</li>
<li><strong>可能原因</strong>：通常是由于节点与 API Server 之间的网络问题，或者 kubelet 进程崩溃导致。</li>
</ul>
<h3 id="7-生命周期钩子lifecycle-hooks">7. 生命周期钩子（Lifecycle Hooks）</h3>
<p>Kubernetes 允许为 Pod 中的容器定义生命周期钩子，这些钩子会在容器的特定阶段执行。</p>
<ul>
<li><strong>postStart</strong>：容器启动后立即执行的操作，可用于初始化工作，例如创建必要的文件或目录。</li>
<li><strong>preStop</strong>：容器终止前执行的操作，可用于优雅关闭应用程序，比如保存数据、释放资源等。</li>
</ul>
<p>以下是包含生命周期钩子的 Pod 示例：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">lifecycle-hook-pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">my-container</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.14.2</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">lifecycle</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">postStart</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">exec</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">command</span>:
</span></span><span style="display:flex;"><span>              [<span style="color:#e6db74">&#34;/bin/sh&#34;</span>, <span style="color:#e6db74">&#34;-c&#34;</span>, <span style="color:#e6db74">&#34;echo &#39;Container started&#39; &gt; /tmp/start.log&#34;</span>]
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">preStop</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">exec</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">command</span>: [<span style="color:#e6db74">&#34;/usr/sbin/nginx&#34;</span>, <span style="color:#e6db74">&#34;-s&#34;</span>, <span style="color:#e6db74">&#34;quit&#34;</span>]
</span></span></code></pre></div><h3 id="8-健康检查probes">8. 健康检查（Probes）</h3>
<p>为了确保 Pod 中的应用程序正常运行，Kubernetes 提供了健康检查机制，主要有两种类型的探针：</p>
<ul>
<li><strong>存活探针（Liveness Probe）</strong>：用于检测容器是否存活。如果存活探针失败，Kubernetes 会重启容器。</li>
<li><strong>就绪探针（Readiness Probe）</strong>：用于检测容器是否准备好接收流量。如果就绪探针失败，Kubernetes 会将该 Pod 从服务的负载均衡中移除。</li>
</ul>
<p>以下是包含健康检查的 Pod 示例：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">probe-pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">my-container</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.14.2</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">livenessProbe</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">httpGet</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/healthz</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">port</span>: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">initialDelaySeconds</span>: <span style="color:#ae81ff">15</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">periodSeconds</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">readinessProbe</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">httpGet</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/ready</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">port</span>: <span style="color:#ae81ff">80</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">initialDelaySeconds</span>: <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">periodSeconds</span>: <span style="color:#ae81ff">10</span>
</span></span></code></pre></div><h2 id="三pod-的调度">三、Pod 的调度</h2>
<h3 id="1-调度器的作用">1. 调度器的作用</h3>
<p>Kubernetes 中的调度器（Scheduler）负责将 Pod 分配到合适的节点上运行。调度器会综合考虑节点的资源状况、Pod 的资源请求以及各种调度策略来做出决策。</p>
<h3 id="2-调度过程">2. 调度过程</h3>
<h4 id="预选阶段predicate">预选阶段（Predicate）</h4>
<p>调度器会根据一系列规则过滤掉不满足条件的节点，主要规则如下：</p>
<ul>
<li><strong>资源检查</strong>：检查节点的可用 CPU、内存等资源是否满足 Pod 的请求。如果节点资源不足，该节点会被排除。</li>
<li><strong>节点选择器（NodeSelector）</strong>：如果 Pod 定义了 <code>nodeSelector</code>，调度器会只考虑带有相应标签的节点。</li>
<li><strong>节点亲和性与反亲和性（Node Affinity and Anti - Affinity）</strong>：可以定义 Pod 与节点之间的亲和或反亲和关系。例如，要求 Pod 必须调度到特定区域的节点上，或者避免调度到某些节点上。</li>
<li><strong>污点与容忍度（Taints and Tolerations）</strong>：节点可以设置污点，防止某些 Pod 被调度到该节点上；而 Pod 可以设置容忍度，表示它可以容忍哪些污点。</li>
</ul>
<h4 id="优选阶段priority">优选阶段（Priority）</h4>
<p>在通过预选的节点中，调度器会对每个节点进行打分，选择得分最高的节点。打分的依据有很多，例如：</p>
<ul>
<li><strong>节点负载情况</strong>：优先选择负载较低的节点，以保证 Pod 能稳定运行。</li>
<li><strong>与其他 Pod 的亲和性</strong>：为了提高性能或实现高可用，可能会优先选择与其他相关 Pod 在同一节点或不同节点的节点。</li>
</ul>
<h3 id="3-调度策略示例">3. 调度策略示例</h3>
<h4 id="节点选择器">节点选择器</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">node-selector-pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">my-container</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.14.2</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">nodeSelector</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">disktype</span>: <span style="color:#ae81ff">ssd</span>
</span></span></code></pre></div><p>上述示例中，Pod 会被调度到带有 <code>disktype: ssd</code> 标签的节点上。</p>
<h4 id="节点亲和性">节点亲和性</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">node-affinity-pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">my-container</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.14.2</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">affinity</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">nodeAffinity</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">requiredDuringSchedulingIgnoredDuringExecution</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">nodeSelectorTerms</span>:
</span></span><span style="display:flex;"><span>          - <span style="color:#f92672">matchExpressions</span>:
</span></span><span style="display:flex;"><span>              - <span style="color:#f92672">key</span>: <span style="color:#ae81ff">region</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">operator</span>: <span style="color:#ae81ff">In</span>
</span></span><span style="display:flex;"><span>                <span style="color:#f92672">values</span>:
</span></span><span style="display:flex;"><span>                  - <span style="color:#ae81ff">us-west</span>
</span></span></code></pre></div><p>此示例中，Pod 必须被调度到带有 <code>region: us-west</code> 标签的节点上。</p>
<h4 id="污点与容忍度">污点与容忍度</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">taint-toleration-pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">my-container</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.14.2</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">tolerations</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">key</span>: <span style="color:#e6db74">&#34;dedicated&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">operator</span>: <span style="color:#e6db74">&#34;Equal&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;special-user&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">effect</span>: <span style="color:#e6db74">&#34;NoSchedule&#34;</span>
</span></span></code></pre></div><p>该 Pod 可以容忍带有 <code>dedicated: special-user</code> 污点且效果为 <code>NoSchedule</code> 的节点。</p>
<h3 id="4-调度失败处理">4. 调度失败处理</h3>
<p>如果调度器无法为 Pod 找到合适的节点，Pod 会一直处于 Pending 状态。可以通过查看 <code>kubectl describe pod &lt;pod-name&gt;</code> 的输出信息来定位调度失败的原因，常见原因包括节点资源不足、节点标签不匹配等。</p>
<h2 id="四总结">四、总结</h2>
<p>Pod 作为 Kubernetes 中最核心的概念之一，其生命周期和调度机制对于有效管理和运行容器化应用程序起着至关重要的作用。通过合理配置 Pod 的生命周期钩子、健康检查和调度策略，能够显著提高应用程序的可用性和性能。同时，深入理解 Pod 的相关知识，有助于更好地应对 Kubernetes 集群中的各种场景和问题。</p>
<h1 id="controller-解析">Controller 解析：</h1>
<h2 id="一controller-概述">一、Controller 概述</h2>
<p>在 Kubernetes 中，控制器（Controller）是一个核心概念，它是一种控制循环，通过持续监控 Kubernetes API 服务器中的对象状态，并根据期望状态与实际状态的差异采取相应的操作，以确保系统始终处于用户所期望的状态。控制器不断地比较期望状态和实际状态，然后对资源进行创建、更新或删除操作，使实际状态逐渐趋近于期望状态。</p>
<h2 id="二常见控制器详细解析">二、常见控制器详细解析</h2>
<h3 id="1deployment">1.Deployment</h3>
<h4 id="11-功能作用">1.1 功能作用</h4>
<p>Deployment 是 Kubernetes 中用于管理无状态应用的工作负载资源。它主要用于定义 Pod 的模板，控制 Pod 的副本数量，支持滚动更新、回滚、扩缩容等操作，从而确保应用的高可用性和可扩展性。通过 Deployment，你可以方便地对应用进行版本管理和更新，而无需手动管理每个 Pod。</p>
<h4 id="12-创建的资源清单示例">1.2 创建的资源清单示例</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span> <span style="color:#75715e">#版本号</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Deployment</span> <span style="color:#75715e">#类型</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>: <span style="color:#75715e">#元数据</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#75715e">#rs名称</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">namespace</span>: <span style="color:#75715e">#所属命名空间</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>: <span style="color:#75715e">#标签</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">controller</span>: <span style="color:#ae81ff">deploy</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>: <span style="color:#75715e">#详情描述</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">replicas</span>: <span style="color:#75715e">#副本数量</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">revisionHistoryLimit</span>: <span style="color:#75715e">#保留历史版本，默认是10</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">paused</span>: <span style="color:#75715e">#暂停部署，默认是false</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">progressDeadlineSeconds</span>: <span style="color:#75715e">#部署超时时间(s)，默认是600</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">strategy</span>: <span style="color:#75715e">#策略</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">RollingUpdates</span> <span style="color:#75715e">#滚动更新策略</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">rollingUpdate</span>: <span style="color:#75715e">#滚动更新</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">maxSurge</span>: <span style="color:#75715e">#最大额外可以存在的副本数，可以为百分比，也可以为整数</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">maxUnavaliable</span>: <span style="color:#75715e">#最大不可用状态的pod的最大值，可以为百分比，也可以为整数</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>: <span style="color:#75715e">#选择器，通过它指定该控制器管理哪些pod</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">matchLabels</span>: <span style="color:#75715e">#Labels匹配规则</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">app</span>: <span style="color:#ae81ff">nginx-pod</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">matchExpressions</span>: <span style="color:#75715e">#Expression匹配规则</span>
</span></span><span style="display:flex;"><span>      - { <span style="color:#f92672">key: app, operator: In, values</span>: [<span style="color:#ae81ff">nginx-pod] }</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>: <span style="color:#75715e">#模板，当副本数量不足时，会根据下面的模板创建pod副本</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">app</span>: <span style="color:#ae81ff">nginx-pod</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.17.1</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>            - <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">80</span>
</span></span></code></pre></div><ul>
<li><code>apiVersion</code>：指定使用的 Kubernetes API 版本。</li>
<li><code>kind</code>：指定资源类型为 Deployment。</li>
<li><code>metadata</code>：包含 Deployment 的名称和标签等元数据。</li>
<li><code>spec.replicas</code>：指定要创建的 Pod 副本数量。</li>
<li><code>spec.selector</code>：用于选择要管理的 Pod，通过标签匹配。</li>
<li><code>spec.template</code>：定义 Pod 的模板，包含 Pod 的元数据和容器配置。</li>
</ul>
<h4 id="13-底层架构逻辑">1.3 底层架构逻辑</h4>
<p><img src="index.assets/image-20250314193159292.png" alt="image-20250314193159292"></p>
<ul>
<li>Deployment 通过创建和管理 ReplicaSet 来间接管理 Pod。每个 Deployment 可以有多个 ReplicaSet，但只有一个是活跃的，用于维持当前的 Pod 副本数量。</li>
<li>当你更新 Deployment 时，会创建一个新的 ReplicaSet，新的 ReplicaSet 会逐渐创建新的 Pod，同时旧的 ReplicaSet 会逐渐减少旧 Pod 的数量，实现滚动更新。</li>
</ul>
<h4 id="14-扩缩容">1.4 扩缩容</h4>
<ul>
<li>
<p><strong>方式一：命令行</strong></p>
<ul>
<li>
<p>命令</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl scale deploy deploy名称 --replicas<span style="color:#f92672">=</span>pod数量 -n 命名空间
</span></span></code></pre></div><p>通过命令行变更 pod 数量为 5 个</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@master ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl scale deploy pc-deployment --replicas=5 -n dev</span>
</span></span><span style="display:flex;"><span>deployment.apps/pc-deployment scaled
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@master ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pod -n dev</span>
</span></span><span style="display:flex;"><span>NAME                             READY   STATUS    RESTARTS   AGE
</span></span><span style="display:flex;"><span>pc-deployment-5d89bdfbf9-bhcns   1/1     Running   <span style="color:#ae81ff">0</span>          83s
</span></span><span style="display:flex;"><span>pc-deployment-5d89bdfbf9-cfls7   1/1     Running   <span style="color:#ae81ff">0</span>          83s
</span></span><span style="display:flex;"><span>pc-deployment-5d89bdfbf9-k8j9n   1/1     Running   <span style="color:#ae81ff">0</span>          8m54s
</span></span><span style="display:flex;"><span>pc-deployment-5d89bdfbf9-vw87k   1/1     Running   <span style="color:#ae81ff">0</span>          8m54s
</span></span><span style="display:flex;"><span>pc-deployment-5d89bdfbf9-x7nsm   1/1     Running   <span style="color:#ae81ff">0</span>          8m54s
</span></span></code></pre></div></li>
</ul>
</li>
<li>
<p><strong>方式二：资源清单</strong></p>
<ul>
<li>
<p>命令</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl edit deploy deploy名字 -n 命名空间
</span></span></code></pre></div><p>通过编辑 deploy 文件编辑 pod 数量为 3 个</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@master ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl edit deploy pc-deployment -n dev</span>
</span></span><span style="display:flex;"><span>找到replicas，将其数量改为3
</span></span><span style="display:flex;"><span>spec:
</span></span><span style="display:flex;"><span>  progressDeadlineSeconds: <span style="color:#ae81ff">600</span>
</span></span><span style="display:flex;"><span>  replicas: <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@master ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pod -n dev</span>
</span></span><span style="display:flex;"><span>NAME                             READY   STATUS    RESTARTS   AGE
</span></span><span style="display:flex;"><span>pc-deployment-5d89bdfbf9-k8j9n   1/1     Running   <span style="color:#ae81ff">0</span>          15m
</span></span><span style="display:flex;"><span>pc-deployment-5d89bdfbf9-vw87k   1/1     Running   <span style="color:#ae81ff">0</span>          15m
</span></span><span style="display:flex;"><span>pc-deployment-5d89bdfbf9-x7nsm   1/1     Running   <span style="color:#ae81ff">0</span>          15m
</span></span></code></pre></div></li>
</ul>
</li>
</ul>
<h4 id="15-镜像更新">1.5 镜像更新</h4>
<p>deployment 支持两种镜像更新策略：<strong>重建更新</strong>和<strong>滚动更新（默认）</strong>，可以通过 strategy 选项进行配置</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#ae81ff">strategy：指定新的pod替换旧的pod的策略，支持两个属性：</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">type：指定策略类型，支持两种策略</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">Recreate：在创建出新的pod之前会先杀掉所有已存在的pod</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">RollingUpdate：滚动更新，就是杀死一部分，就启动一部分，在更新过程中，存在两个版本pod</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">rollingUpdate：当type为RollingUpdate时生效，用于为RollingUpdate设置参数，支持两个属性</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">maxUnavailable：用来指定在升级过程中不可用pod的最大数量，默认为25%</span>
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">maxSurge：用来指定在升级过程中可以超过期望的pod的最大数量，默认为25%</span>
</span></span></code></pre></div><ul>
<li>
<p><strong>重建更新</strong></p>
<p>编辑 pc-deployment.yaml，在 spec 节点下添加更新策略</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">strategy</span>: <span style="color:#75715e">#策略</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">type</span>: <span style="color:#ae81ff">Recreate</span> <span style="color:#75715e">#重建更新策略</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@master ~<span style="color:#f92672">]</span><span style="color:#75715e"># vim pc-deployment.yaml</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@master ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl apply -f pc-deployment.yaml</span>
</span></span><span style="display:flex;"><span>Warning: kubectl apply should be used on resource created by either kubectl create --save-config or kubectl apply
</span></span><span style="display:flex;"><span>deployment.apps/pc-deployment configured
</span></span></code></pre></div><p>创建 deploy 进行验证</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#首先记录原本的pod名</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@master ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pod -n dev</span>
</span></span><span style="display:flex;"><span>NAME                             READY   STATUS    RESTARTS   AGE
</span></span><span style="display:flex;"><span>pc-deployment-5d89bdfbf9-bqf86   1/1     Running   <span style="color:#ae81ff">0</span>          8s
</span></span><span style="display:flex;"><span>pc-deployment-5d89bdfbf9-kz6jt   1/1     Running   <span style="color:#ae81ff">0</span>          8s
</span></span><span style="display:flex;"><span>pc-deployment-5d89bdfbf9-z7d9z   1/1     Running   <span style="color:#ae81ff">0</span>          8s
</span></span><span style="display:flex;"><span><span style="color:#75715e">#更改pod镜像</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@master ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl set image deploy pc-deployment nginx=nginx:1.17.2 -n dev</span>
</span></span><span style="display:flex;"><span>deployment.apps/pc-deployment image updated
</span></span><span style="display:flex;"><span><span style="color:#75715e">#再次查看镜像</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@master ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pod -n dev</span>
</span></span><span style="display:flex;"><span>NAME                             READY   STATUS    RESTARTS   AGE
</span></span><span style="display:flex;"><span>pc-deployment-675d469f8b-b9rwd   1/1     Running   <span style="color:#ae81ff">0</span>          27s
</span></span><span style="display:flex;"><span>pc-deployment-675d469f8b-kc7rr   1/1     Running   <span style="color:#ae81ff">0</span>          27s
</span></span><span style="display:flex;"><span>pc-deployment-675d469f8b-kxgkq   1/1     Running   <span style="color:#ae81ff">0</span>          27s
</span></span></code></pre></div><p>发现 pod 镜像已经改变了</p>
</li>
<li>
<p><strong>滚动更新</strong></p>
<p>编辑 pc-deployment.yaml，在 spec 节点下添加滚动更新策略（也可以把 strategy 去掉，因为默认滚动更新策略</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">strategy</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">type</span>: <span style="color:#ae81ff">RollingUpdate</span> <span style="color:#75715e">#滚动更新策略</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">rollingUpdate</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">maxUnavailable</span>: <span style="color:#ae81ff">25</span><span style="color:#ae81ff">%</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">maxSurge</span>: <span style="color:#ae81ff">25</span><span style="color:#ae81ff">%</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@master ~<span style="color:#f92672">]</span><span style="color:#75715e"># vim pc-deployment.yaml</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@master ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl apply -f pc-deployment.yaml</span>
</span></span><span style="display:flex;"><span>Warning: kubectl apply should be used on resource created by either kubectl create --save-config or kubectl apply
</span></span><span style="display:flex;"><span>deployment.apps/pc-deployment configured
</span></span></code></pre></div><p>创建 deploy 进行验证</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#记录以前的pod</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@master ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pod -n dev</span>
</span></span><span style="display:flex;"><span>NAME                             READY   STATUS    RESTARTS   AGE
</span></span><span style="display:flex;"><span>pc-deployment-5d89bdfbf9-526wf   1/1     Running   <span style="color:#ae81ff">0</span>          61s
</span></span><span style="display:flex;"><span>pc-deployment-5d89bdfbf9-b5x5v   1/1     Running   <span style="color:#ae81ff">0</span>          64s
</span></span><span style="display:flex;"><span>pc-deployment-5d89bdfbf9-kc7hb   1/1     Running   <span style="color:#ae81ff">0</span>          59s
</span></span><span style="display:flex;"><span><span style="color:#75715e">#更新镜像</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@master ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl set image deploy pc-deployment nginx=nginx:1.17.2 -n dev</span>
</span></span><span style="display:flex;"><span>deployment.apps/pc-deployment image updated
</span></span><span style="display:flex;"><span><span style="color:#75715e">#查看pod状态</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@master ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pod -n dev</span>
</span></span><span style="display:flex;"><span>NAME                             READY   STATUS              RESTARTS   AGE
</span></span><span style="display:flex;"><span>pc-deployment-5d89bdfbf9-526wf   0/1     Terminating         <span style="color:#ae81ff">0</span>          2m2s
</span></span><span style="display:flex;"><span>pc-deployment-5d89bdfbf9-b5x5v   1/1     Running             <span style="color:#ae81ff">0</span>          2m5s
</span></span><span style="display:flex;"><span>pc-deployment-5d89bdfbf9-kc7hb   0/1     Terminating         <span style="color:#ae81ff">0</span>          2m
</span></span><span style="display:flex;"><span>pc-deployment-675d469f8b-7vw6x   1/1     Running             <span style="color:#ae81ff">0</span>          3s
</span></span><span style="display:flex;"><span>pc-deployment-675d469f8b-rzq82   0/1     ContainerCreating   <span style="color:#ae81ff">0</span>          2s
</span></span><span style="display:flex;"><span>pc-deployment-675d469f8b-zk4fs   1/1     Running             <span style="color:#ae81ff">0</span>          5s
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@master ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pod -n dev</span>
</span></span><span style="display:flex;"><span>NAME                             READY   STATUS    RESTARTS   AGE
</span></span><span style="display:flex;"><span>pc-deployment-675d469f8b-7vw6x   1/1     Running   <span style="color:#ae81ff">0</span>          38s
</span></span><span style="display:flex;"><span>pc-deployment-675d469f8b-rzq82   1/1     Running   <span style="color:#ae81ff">0</span>          37s
</span></span><span style="display:flex;"><span>pc-deployment-675d469f8b-zk4fs   1/1     Running   <span style="color:#ae81ff">0</span>          40s
</span></span></code></pre></div><p>发现 pod 是旧的一遍停止新的一边创建，最后全变成了新的</p>
<p>滚动更新的过程</p>
<p><img src="index.assets/image-20250314194857236.png" alt="image-20250314194857236"></p>
</li>
</ul>
<h4 id="16-版本回退">1.6 版本回退</h4>
<p>deployment 支持版本升级过程中的暂停，继续功能以及版本回退等诸多功能，下面具体来看</p>
<p>kubectl rollout：版本升级相关功能，支持下面的选项：</p>
<ul>
<li>status：显示当前升级状态</li>
<li>history：显示升级历史记录</li>
<li>pause：暂停版本升级过程</li>
<li>resume：继续已经暂停的版本升级过程</li>
<li>restart：重启版本升级过程</li>
<li>undo：回滚到上一级版本（可以使用&ndash;to-revision 回滚到指定版本</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#查看升级状态</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@master ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl rollout status deploy pc-deployment -n dev</span>
</span></span><span style="display:flex;"><span>deployment <span style="color:#e6db74">&#34;pc-deployment&#34;</span> successfully rolled out
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#查看升级历史（注意：如果只显示版本号说明一开始使用yaml创建文件的时候没有加上--record命令）</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@master ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl rollout history deploy pc-deployment -n dev</span>
</span></span><span style="display:flex;"><span>deployment.apps/pc-deployment
</span></span><span style="display:flex;"><span>REVISION  CHANGE-CAUSE
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1</span>         kubectl create --filename<span style="color:#f92672">=</span>pc-deployment.yaml --record<span style="color:#f92672">=</span>true
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">2</span>         kubectl create --filename<span style="color:#f92672">=</span>pc-deployment.yaml --record<span style="color:#f92672">=</span>true
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#版本回滚</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#这里使用--to-revision=1回滚到1版本，如果省略这个选项，则会回退到上个版本</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@master ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl rollout undo deploy pc-deployment --to-revision=1 -n dev</span>
</span></span><span style="display:flex;"><span>deployment.apps/pc-deployment rolled back
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#查看是否回滚成功，发现5序号开头的rs被启动了</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@master ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get rs -n dev</span>
</span></span><span style="display:flex;"><span>NAME                       DESIRED   CURRENT   READY   AGE
</span></span><span style="display:flex;"><span>pc-deployment-5d89bdfbf9   <span style="color:#ae81ff">3</span>         <span style="color:#ae81ff">3</span>         <span style="color:#ae81ff">3</span>       31m
</span></span><span style="display:flex;"><span>pc-deployment-675d469f8b   <span style="color:#ae81ff">0</span>         <span style="color:#ae81ff">0</span>         <span style="color:#ae81ff">0</span>       22m
</span></span></code></pre></div><h4 id="17-金丝雀发布">1.7 金丝雀发布</h4>
<p>deployment 支持更新过程中的控制，如&quot;暂停（pause）&ldquo;或&quot;继续（resume）&ldquo;更新操作</p>
<p>比如有一批新的 pod 资源创建完成后立即暂停更新过程，此时，仅存在一部分新版本的应用，主体部分还是旧的版本。然后，再筛选一小部分的用户请求路由到新的 pod 应用，继续观察能否稳定地按期望的方式运行。确定没问题之后再继续完成余下的 pod 资源滚动更新，否则立即回滚更新操作。这就是所谓的金丝雀发布。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#更新deployment版本，并配置暂停deployment</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@master ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl set image deploy pc-deployment nginx=nginx:1.17.2 -n dev &amp;&amp; kubectl rollout pause deploy pc-deployment -n dev</span>
</span></span><span style="display:flex;"><span>deployment.apps/pc-deployment image updated
</span></span><span style="display:flex;"><span>deployment.apps/pc-deployment paused
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#查看rs，发现老版本rs没有减少，新版本rs增加一个</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@master ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get rs -n dev</span>
</span></span><span style="display:flex;"><span>NAME                       DESIRED   CURRENT   READY   AGE
</span></span><span style="display:flex;"><span>pc-deployment-5d89bdfbf9   <span style="color:#ae81ff">3</span>         <span style="color:#ae81ff">3</span>         <span style="color:#ae81ff">3</span>       44m
</span></span><span style="display:flex;"><span>pc-deployment-675d469f8b   <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>         <span style="color:#ae81ff">1</span>       35m
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#在窗口2中查看deploy状态，发现deploy正在等待更新且已经有1个更新好了</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@master ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl rollout status deploy pc-deployment -n dev</span>
</span></span><span style="display:flex;"><span>Waiting <span style="color:#66d9ef">for</span> deployment <span style="color:#e6db74">&#34;pc-deployment&#34;</span> rollout to finish: <span style="color:#ae81ff">1</span> out of <span style="color:#ae81ff">3</span> new replicas have been updated...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#在窗口1中继续deploy的更新</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@master ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl rollout resume deploy pc-deployment -n dev</span>
</span></span><span style="display:flex;"><span>deployment.apps/pc-deployment resumed
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#查看窗口2的状态</span>
</span></span><span style="display:flex;"><span>Waiting <span style="color:#66d9ef">for</span> deployment spec update to be observed...
</span></span><span style="display:flex;"><span>Waiting <span style="color:#66d9ef">for</span> deployment spec update to be observed...
</span></span><span style="display:flex;"><span>Waiting <span style="color:#66d9ef">for</span> deployment <span style="color:#e6db74">&#34;pc-deployment&#34;</span> rollout to finish: <span style="color:#ae81ff">1</span> out of <span style="color:#ae81ff">3</span> new replicas have been updated...
</span></span><span style="display:flex;"><span>Waiting <span style="color:#66d9ef">for</span> deployment <span style="color:#e6db74">&#34;pc-deployment&#34;</span> rollout to finish: <span style="color:#ae81ff">1</span> out of <span style="color:#ae81ff">3</span> new replicas have been updated...
</span></span><span style="display:flex;"><span>Waiting <span style="color:#66d9ef">for</span> deployment <span style="color:#e6db74">&#34;pc-deployment&#34;</span> rollout to finish: <span style="color:#ae81ff">2</span> out of <span style="color:#ae81ff">3</span> new replicas have been updated...
</span></span><span style="display:flex;"><span>Waiting <span style="color:#66d9ef">for</span> deployment <span style="color:#e6db74">&#34;pc-deployment&#34;</span> rollout to finish: <span style="color:#ae81ff">2</span> out of <span style="color:#ae81ff">3</span> new replicas have been updated...
</span></span><span style="display:flex;"><span>Waiting <span style="color:#66d9ef">for</span> deployment <span style="color:#e6db74">&#34;pc-deployment&#34;</span> rollout to finish: <span style="color:#ae81ff">2</span> out of <span style="color:#ae81ff">3</span> new replicas have been updated...
</span></span><span style="display:flex;"><span>Waiting <span style="color:#66d9ef">for</span> deployment <span style="color:#e6db74">&#34;pc-deployment&#34;</span> rollout to finish: <span style="color:#ae81ff">1</span> old replicas are pending termination...
</span></span><span style="display:flex;"><span>Waiting <span style="color:#66d9ef">for</span> deployment <span style="color:#e6db74">&#34;pc-deployment&#34;</span> rollout to finish: <span style="color:#ae81ff">1</span> old replicas are pending termination...
</span></span><span style="display:flex;"><span>deployment <span style="color:#e6db74">&#34;pc-deployment&#34;</span> successfully rolled out
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">#在窗口1查看rs更新结果，发现老版本均停止，新版本已经创建好</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@master ~<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get rs -n dev</span>
</span></span><span style="display:flex;"><span>NAME                       DESIRED   CURRENT   READY   AGE
</span></span><span style="display:flex;"><span>pc-deployment-5d89bdfbf9   <span style="color:#ae81ff">0</span>         <span style="color:#ae81ff">0</span>         <span style="color:#ae81ff">0</span>       49m
</span></span><span style="display:flex;"><span>pc-deployment-675d469f8b   <span style="color:#ae81ff">3</span>         <span style="color:#ae81ff">3</span>         <span style="color:#ae81ff">3</span>       40m
</span></span></code></pre></div><h3 id="2-replicaset">2. ReplicaSet</h3>
<h4 id="21-功能作用">2.1 功能作用</h4>
<p>ReplicaSet 的主要功能是确保在任何时候都有指定数量的 Pod 副本处于运行状态。它是 Deployment 实现滚动更新的基础，Deployment 通过创建和管理 ReplicaSet 来间接管理 Pod。当 Pod 因为各种原因（如节点故障、容器崩溃等）终止时，ReplicaSet 会自动创建新的 Pod 来替换它们。</p>
<h4 id="22-创建的资源清单示例">2.2 创建的资源清单示例</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ReplicaSet</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx-replicaset</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">app</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">matchLabels</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">app</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">app</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">nginx</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">image</span>: <span style="color:#ae81ff">nginx:1.14.2</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>            - <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">80</span>
</span></span></code></pre></div><ul>
<li>与 Deployment 的资源清单类似，<code>spec.replicas</code> 定义了 Pod 的副本数量，<code>spec.selector</code> 用于选择要管理的 Pod，<code>spec.template</code> 定义了 Pod 的模板。</li>
</ul>
<h4 id="23--底层架构逻辑">2.3  底层架构逻辑</h4>
<p><img src="index.assets/image-20250314195924483.png" alt="image-20250314195924483"></p>
<ul>
<li>ReplicaSet 直接管理一组 Pod，通过 <code>selector</code> 来识别和管理与指定标签匹配的 Pod。当实际的 Pod 数量与 <code>replicas</code> 指定的数量不一致时，ReplicaSet 会创建或删除 Pod 以达到期望的数量。</li>
</ul>
<h4 id="24-scale-水平扩展的数量">2.4 scale 水平扩展的数量</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>kubectl scale rs nginx --replicas<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>kubectl get  rs
</span></span><span style="display:flex;"><span>kubectl scale rs nginx --replicas<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>kubectl get  pods -o wide
</span></span></code></pre></div><h3 id="3-statefulset">3. StatefulSet</h3>
<h4 id="31-功能作用">3.1 功能作用</h4>
<p>StatefulSet 用于管理有状态的应用，如数据库、分布式系统等。与 Deployment 管理的无状态应用不同，StatefulSet 为每个 Pod 提供稳定的网络标识（如唯一的 DNS 名称）和持久化存储。这使得 Pod 在重启、迁移或扩展时能够保留其状态，确保应用的一致性和可靠性。</p>
<h4 id="32-创建的资源清单示例">3.2 创建的资源清单示例</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">StatefulSet</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">mysql-statefulset</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">serviceName</span>: <span style="color:#e6db74">&#34;mysql-service&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">replicas</span>: <span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">matchLabels</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">app</span>: <span style="color:#ae81ff">mysql</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">app</span>: <span style="color:#ae81ff">mysql</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">mysql</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">image</span>: <span style="color:#ae81ff">mysql:8.0</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">ports</span>:
</span></span><span style="display:flex;"><span>            - <span style="color:#f92672">containerPort</span>: <span style="color:#ae81ff">3306</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">volumeMounts</span>:
</span></span><span style="display:flex;"><span>            - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">mysql-persistent-storage</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/var/lib/mysql</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">volumeClaimTemplates</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">name</span>: <span style="color:#ae81ff">mysql-persistent-storage</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">accessModes</span>: [<span style="color:#e6db74">&#34;ReadWriteOnce&#34;</span>]
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">resources</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">requests</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">storage</span>: <span style="color:#ae81ff">1Gi</span>
</span></span></code></pre></div><ul>
<li><code>spec.serviceName</code>：指定与 StatefulSet 关联的服务名称，用于为 Pod 提供稳定的网络标识。</li>
<li><code>spec.volumeClaimTemplates</code>：定义持久卷声明模板，为每个 Pod 创建一个持久卷。</li>
</ul>
<h4 id="33-底层架构逻辑">3.3 底层架构逻辑</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-plaintext" data-lang="plaintext"><span style="display:flex;"><span>+----------------------+
</span></span><span style="display:flex;"><span>|    StatefulSet       |
</span></span><span style="display:flex;"><span>+----------------------+
</span></span><span style="display:flex;"><span>         |
</span></span><span style="display:flex;"><span>         v
</span></span><span style="display:flex;"><span>+----------------------+
</span></span><span style="display:flex;"><span>|  mysql-statefulset-0 |
</span></span><span style="display:flex;"><span>+----------------------+
</span></span><span style="display:flex;"><span>|  mysql-statefulset-1 |
</span></span><span style="display:flex;"><span>+----------------------+
</span></span><span style="display:flex;"><span>|  mysql-statefulset-2 |
</span></span><span style="display:flex;"><span>+----------------------+
</span></span><span style="display:flex;"><span>         |
</span></span><span style="display:flex;"><span>         v
</span></span><span style="display:flex;"><span>+----------------------+
</span></span><span style="display:flex;"><span>| Persistent Volume 0  |
</span></span><span style="display:flex;"><span>+----------------------+
</span></span><span style="display:flex;"><span>| Persistent Volume 1  |
</span></span><span style="display:flex;"><span>+----------------------+
</span></span><span style="display:flex;"><span>| Persistent Volume 2  |
</span></span><span style="display:flex;"><span>+----------------------+
</span></span></code></pre></div><ul>
<li>StatefulSet 为每个 Pod 分配一个唯一的序号，从 0 开始递增。Pod 的名称格式为 <code>{statefulset-name}-{ordinal}</code>，例如 <code>mysql-statefulset-0</code>。</li>
<li>每个 Pod 都有一个独立的持久卷声明（PVC），用于挂载持久化存储，确保数据的持久化。</li>
</ul>
<h4 id="34-滚动升级原理">3.4 滚动升级原理</h4>
<p>StatefulSet 的滚动升级与 Deployment 类似，但有一些额外的考虑。当进行滚动升级时，StatefulSet 会按照序号从大到小的顺序依次更新 Pod，并且在更新每个 Pod 之前会等待前一个 Pod 成功更新并就绪。这确保了应用的状态在升级过程中保持一致。</p>
<h3 id="4-daemonset">4. DaemonSet</h3>
<h4 id="41-功能作用">4.1 功能作用</h4>
<p>DaemonSet 确保在集群中的每个节点（或满足特定条件的节点）上都运行一个 Pod 副本。常用于系统级的守护进程，如日志收集器、监控代理等。当有新节点加入集群时，DaemonSet 会自动在该节点上创建一个新的 Pod；当节点从集群中移除时，对应的 Pod 会被自动删除。</p>
<h4 id="42-创建的资源清单示例">4.2 创建的资源清单示例</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">apps/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">DaemonSet</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">fluentd-daemonset</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">app</span>: <span style="color:#ae81ff">fluentd</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">selector</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">matchLabels</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">app</span>: <span style="color:#ae81ff">fluentd</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">labels</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">app</span>: <span style="color:#ae81ff">fluentd</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">fluentd</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">image</span>: <span style="color:#ae81ff">fluentd:v1.14</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">volumeMounts</span>:
</span></span><span style="display:flex;"><span>            - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">varlog</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/var/log</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">volumes</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">varlog</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">hostPath</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#f92672">path</span>: <span style="color:#ae81ff">/var/log</span>
</span></span></code></pre></div><ul>
<li>通过 <code>hostPath</code> 卷将节点的 <code>/var/log</code> 目录挂载到 Pod 中，方便收集节点的日志。</li>
</ul>
<h4 id="43-底层架构逻辑">4.3 底层架构逻辑</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-plaintext" data-lang="plaintext"><span style="display:flex;"><span>+----------------------+
</span></span><span style="display:flex;"><span>|    DaemonSet         |
</span></span><span style="display:flex;"><span>+----------------------+
</span></span><span style="display:flex;"><span>         |
</span></span><span style="display:flex;"><span>         v
</span></span><span style="display:flex;"><span>+----------------------+
</span></span><span style="display:flex;"><span>| Node 1: Pod 1        |
</span></span><span style="display:flex;"><span>+----------------------+
</span></span><span style="display:flex;"><span>| Node 2: Pod 2        |
</span></span><span style="display:flex;"><span>+----------------------+
</span></span><span style="display:flex;"><span>| Node 3: Pod 3        |
</span></span><span style="display:flex;"><span>+----------------------+
</span></span></code></pre></div><ul>
<li>DaemonSet 会在每个符合条件的节点上创建一个 Pod 副本，确保每个节点都有特定的服务在运行。</li>
</ul>
<h3 id="5-job">5. Job</h3>
<h4 id="51-功能作用">5.1 功能作用</h4>
<p>Job 用于运行一次性任务，当任务完成后，Pod 会终止。常用于批处理作业、数据迁移、脚本执行等场景。Job 会创建一个或多个 Pod 来执行任务，当所有 Pod 都成功完成任务后，Job 被标记为完成。</p>
<h4 id="52-创建的资源清单示例">5.2 创建的资源清单示例</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">batch/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Job</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">pi-job</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">template</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>        - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">pi</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">image</span>: <span style="color:#ae81ff">perl:5.34.0</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">command</span>: [<span style="color:#e6db74">&#34;perl&#34;</span>, <span style="color:#e6db74">&#34;-Mbignum=bpi&#34;</span>, <span style="color:#e6db74">&#34;-wle&#34;</span>, <span style="color:#e6db74">&#34;print bpi(2000)&#34;</span>]
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">restartPolicy</span>: <span style="color:#ae81ff">Never</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">backoffLimit</span>: <span style="color:#ae81ff">4</span>
</span></span></code></pre></div><ul>
<li><code>restartPolicy: Never</code> 表示当 Pod 失败时，不会自动重启。</li>
<li><code>backoffLimit</code> 指定了任务失败后的重试次数。</li>
</ul>
<h4 id="53-底层架构逻辑">5.3 底层架构逻辑</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-plaintext" data-lang="plaintext"><span style="display:flex;"><span>+----------------------+
</span></span><span style="display:flex;"><span>|       Job            |
</span></span><span style="display:flex;"><span>+----------------------+
</span></span><span style="display:flex;"><span>         |
</span></span><span style="display:flex;"><span>         v
</span></span><span style="display:flex;"><span>+----------------------+
</span></span><span style="display:flex;"><span>|      Pod 1           |
</span></span><span style="display:flex;"><span>+----------------------+
</span></span></code></pre></div><ul>
<li>Job 创建一个或多个 Pod 来执行任务，当所有 Pod 都成功完成任务后，Job 结束。</li>
</ul>
<h3 id="6-cronjob">6. CronJob</h3>
<h4 id="61-功能作用">6.1 功能作用</h4>
<p>CronJob 是基于时间的 Job，它按照指定的时间间隔周期性地运行任务，类似于 Linux 系统中的 <code>cron</code> 任务。CronJob 会根据 <code>schedule</code> 字段指定的时间间隔创建 Job，每个 Job 会按照 Job 的规则创建 Pod 来执行任务。</p>
<h4 id="62-创建的资源清单示例">6.2 创建的资源清单示例</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">batch/v1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">CronJob</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">metadata</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">hello-cronjob</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">schedule</span>: <span style="color:#e6db74">&#34;*/1 * * * *&#34;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">jobTemplate</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">template</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">spec</span>:
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">containers</span>:
</span></span><span style="display:flex;"><span>            - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">hello</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">image</span>: <span style="color:#ae81ff">busybox:1.36</span>
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">args</span>:
</span></span><span style="display:flex;"><span>                - <span style="color:#ae81ff">/bin/sh</span>
</span></span><span style="display:flex;"><span>                - -<span style="color:#ae81ff">c</span>
</span></span><span style="display:flex;"><span>                - <span style="color:#ae81ff">date; echo Hello from the Kubernetes cluster</span>
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">restartPolicy</span>: <span style="color:#ae81ff">OnFailure</span>
</span></span></code></pre></div><ul>
<li><code>schedule</code> 使用 Cron 表达式指定任务的调度时间，这里表示每分钟执行一次。</li>
</ul>
<h4 id="63-底层架构逻辑">6.3 底层架构逻辑</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-plaintext" data-lang="plaintext"><span style="display:flex;"><span>+----------------------+
</span></span><span style="display:flex;"><span>|    CronJob           |
</span></span><span style="display:flex;"><span>+----------------------+
</span></span><span style="display:flex;"><span>         |
</span></span><span style="display:flex;"><span>         v
</span></span><span style="display:flex;"><span>+----------------------+
</span></span><span style="display:flex;"><span>|      Job 1           |
</span></span><span style="display:flex;"><span>+----------------------+
</span></span><span style="display:flex;"><span>|      Job 2           |
</span></span><span style="display:flex;"><span>+----------------------+
</span></span><span style="display:flex;"><span>|      ...             |
</span></span><span style="display:flex;"><span>+----------------------+
</span></span><span style="display:flex;"><span>         |
</span></span><span style="display:flex;"><span>         v
</span></span><span style="display:flex;"><span>+----------------------+
</span></span><span style="display:flex;"><span>|      Pod 1           |
</span></span><span style="display:flex;"><span>+----------------------+
</span></span><span style="display:flex;"><span>|      Pod 2           |
</span></span><span style="display:flex;"><span>+----------------------+
</span></span><span style="display:flex;"><span>|      ...             |
</span></span><span style="display:flex;"><span>+----------------------+
</span></span></code></pre></div><ul>
<li>CronJob 按照时间间隔创建 Job，每个 Job 再创建 Pod 来执行任务。</li>
</ul>
<h2 id="三总结">三、总结</h2>
<p>Kubernetes 的控制器为不同类型的应用和任务提供了强大的管理能力。通过合理使用这些控制器，可以确保应用的高可用性、可扩展性和数据的持久性。在实际应用中，需要根据具体需求选择合适的控制器，并深入理解其工作原理和使用方法，以充分发挥 Kubernetes 的优势。</p>
<h1 id="service">Service:</h1>
<h2 id="一service概念">一、Service概念</h2>
<p>Kubernetes <code>Service</code>定义了这样一种抽象：逻辑上的一组 <code>Pod</code>，一种可以访问它们的策略 —— 通常被称为微服务。这一组 <code>Pod </code>能够被 <code>Service</code> 访问到，通常是通过 <code>selector</code>实现的。</p>
<p>举例：考虑一个图片处理 backend，它运行了3个副本。这些副本是可互换的 —— frontend 不需要关心它们调用了哪个 backend 副本。 然而组成这一组 backend 程序的 Pod 实际上可能会发生变化，frontend 客户端不应该也没必要知道，而且也不需要跟踪这一组 backend 的状态。Service 定义的抽象能够解耦这种关联。</p>
<p>Service可以提供负载均衡的能力，但是使用上存在如下限制：</p>
<ul>
<li>只能提供4层负载均衡能力，而没有7层功能。有时我们可能需要更多的匹配规则来转发请求，这点上4层负载均衡是不支持的、</li>
</ul>
<p>如web访问的service服务示例图：</p>
<p><img src="index.assets/image-20250314204622959.png" alt="image-20250314204622959"></p>
<h2 id="二vip和service代理">二、VIP和Service代理</h2>
<p>在 Kubernetes 集群中，每个 <code>Node</code> 运行一个 <code>kube-proxy</code> 进程。<code>kube-proxy</code>负责为 <code>Service</code> 实现了一种 VIP（虚拟 IP）的形式，而不是 ExternalName 的形式。</p>
<p>从Kubernetes v1.0开始，已经可以使用 userspace代理模式。Kubernetes v1.1添加了 iptables 代理模式，在 Kubernetes v1.2 中kube-proxy 的 iptables 模式成为默认设置。Kubernetes v1.8添加了 ipvs 代理模式。</p>
<p><strong>为什么不使用 DNS 轮询？</strong></p>
<p>原因如下：</p>
<ul>
<li>DNS 实现的历史由来已久，它不遵守记录 TTL，并且在名称查找到结果后会对其进行缓存。</li>
<li>有些应用程序仅执行一次 DNS 查找，并无限期地缓存结果。</li>
<li>即使应用和库进行了适当的重新解析，DNS 记录上的 TTL 值低或为零也可能会给 DNS 带来高负载，从而使管理变得困难。</li>
</ul>
<p>总之就是因为有缓存，因此不合适。</p>
<h3 id="1-userspace代理模式">1. Userspace代理模式</h3>
<p>这种模式，kube-proxy 会监视 Kubernetes master 对 Service 对象和 Endpoints 对象的添加和移除。 对每个 Service，它会在本地 Node 上打开一个端口（随机选择）。 任何连接到“代理端口”的请求，都会被代理到 Service 的backend Pods 中的某个上面（如 Endpoints 所报告的一样）。 使用哪个 backend Pod，是 kube-proxy 基于 SessionAffinity 来确定的。</p>
<p>最后，它配置 iptables 规则，捕获到达该 Service 的 clusterIP（是虚拟 IP）和 Port 的请求，并重定向到代理端口，代理端口再代理请求到 backend Pod。</p>
<p>默认情况下，userspace模式下的kube-proxy通过循环算法选择后端。</p>
<p>默认的策略是，通过 round-robin 算法来选择 backend Pod。</p>
<p><img src="index.assets/image-20250314214035038.png" alt="image-20250314214035038"></p>
<h3 id="2-iptables代理模式">2. iptables代理模式</h3>
<p>这种模式，kube-proxy 会监视 Kubernetes 控制节点对 Service 对象和 Endpoints 对象的添加和移除。 对每个 Service，它会配置 iptables 规则，从而捕获到达该 Service 的 clusterIP 和端口的请求，进而将请求重定向到 Service 的一组 backend 中的某个上面。对于每个 Endpoints 对象，它也会配置 iptables 规则，这个规则会选择一个 backend 组合。</p>
<p>默认的策略是，kube-proxy 在 iptables 模式下随机选择一个 backend。</p>
<p>使用 iptables 处理流量具有较低的系统开销，因为流量由 Linux netfilter 处理，而无需在用户空间和内核空间之间切换。 这种方法也可能更可靠。</p>
<p>如果 kube-proxy 在 iptables模式下运行，并且所选的第一个 Pod 没有响应，则连接失败。 这与userspace模式不同：在这种情况下，kube-proxy 将检测到与第一个 Pod 的连接已失败，并会自动使用其他后端 Pod 重试。</p>
<p>我们可以使用 Pod readiness 探测器 验证后端 Pod 是否可以正常工作，以便 iptables 模式下的 kube-proxy 仅看到测试正常的后端。这样做意味着可以避免将流量通过 kube-proxy 发送到已知已失败的Pod。</p>
<p><img src="index.assets/image-20250314214148660.png" alt="image-20250314214148660"></p>
<h3 id="3-ipvs代理模式">3. ipvs代理模式</h3>
<p>在 ipvs 模式下，kube-proxy监视Kubernetes服务(Service)和端点(Endpoints)，调用 netlink 接口相应地创建 IPVS 规则， 并定期将 IPVS 规则与 Kubernetes服务(Service)和端点(Endpoints)同步。该控制循环可确保 IPVS 状态与所需状态匹配。访问服务(Service)时，IPVS　将流量定向到后端Pod之一。</p>
<p>IPVS代理模式基于类似于 iptables 模式的 netfilter 挂钩函数，但是使用哈希表作为基础数据结构，并且在内核空间中工作。 这意味着，与 iptables 模式下的 kube-proxy 相比，IPVS 模式下的 kube-proxy 重定向通信的延迟要短，并且在同步代理规则时具有更好的性能。与其他代理模式相比，IPVS 模式还支持更高的网络流量吞吐量。</p>
<p>IPVS提供了更多选项来平衡后端Pod的流量。这些是：</p>
<ul>
<li>rr: round-robin</li>
<li>lc: least connection (smallest number of open connections)</li>
<li>dh: destination hashing</li>
<li>sh: source hashing</li>
<li>sed: shortest expected delay</li>
<li>nq: never queue</li>
</ul>
<p>注意：要在 IPVS 模式下运行 kube-proxy，必须在启动 kube-proxy 之前使 IPVS Linux 在节点上可用。 当 kube-proxy 以 IPVS 代理模式启动时，它将验证 IPVS 内核模块是否可用。 如果未检测到 IPVS 内核模块，则 kube-proxy 将退回到以 iptables 代理模式运行。</p>
<p><img src="index.assets/image-20250314214542700.png" alt="image-20250314214542700"></p>
<h2 id="三service类型">三、Service类型</h2>
<p>Kubernetes 中Service有以下4中类型：</p>
<ul>
<li><code>ClusterIP</code>：默认类型，自动分配一个仅Cluster内部可以访问的虚拟IP</li>
<li><code>NodePort</code>：通过每个 Node 上的 IP 和静态端口（NodePort）暴露服务。以ClusterIP为基础，NodePort 服务会路由到 ClusterIP 服务。通过请求 <code>&lt;NodeIP&gt;:&lt;NodePort&gt;</code>，可以从集群的外部访问一个集群内部的 NodePort 服务。</li>
<li><code>LoadBalancer</code>：使用云提供商的负载均衡器，可以向外部暴露服务。外部的负载均衡器可以路由到 NodePort 服务和 ClusterIP 服务。</li>
<li><code>ExternalName</code> ：通过返回 CNAME 和它的值，可以将服务映射到 externalName 字段的内容（例如，foo.bar.example.com）。没有任何类型代理被创建。</li>
</ul>
<p>需要注意的是：Service 能够将一个接收 port 映射到任意的 targetPort。默认情况下，targetPort 将被设置为与 port 字段相同的值。</p>
<p>Service域名格式：<code>$(service name).$(namespace).svc.cluster.local</code>，其中 cluster.local 为指定的集群的域名</p>


        
      </section>

      
      <div class="divider w-full"></div>
      <div class="flex flex-col md:flex-row justify-between gap-4 py-4 w-full">
        
        <a class="group btn btn-outline" href="/posts/cicd/harbor/" title="Harbor">
          <ion-icon name="chevron-back"></ion-icon>
          <div class="inline-flex flex-col items-start">
            <span class="text-base-content/60 group-hover:text-neutral-content/60 text-xs font-normal">上一页</span>
            <span class="max-w-48 truncate">Harbor</span>
          </div>
        </a>
        

        
        <div></div>
        
      </div>
      

      
    </article>
  </div>

  
  <div class="hidden lg:flex lg:flex-col lg:items-end lg:col-span-1">
    
    <nav id="TableOfContents">
  <ul>
    <li><a href="#一pod-基础概念">一、Pod 基础概念</a>
      <ul>
        <li><a href="#1-定义">1. 定义</a></li>
        <li><a href="#2-设计理念">2. 设计理念</a></li>
        <li><a href="#3-共享资源">3. 共享资源</a></li>
      </ul>
    </li>
    <li><a href="#二pod-的生命周期">二、Pod 的生命周期</a>
      <ul>
        <li><a href="#1-pending挂起">1. Pending（挂起）</a></li>
        <li><a href="#2-containercreating容器创建中">2. ContainerCreating（容器创建中）</a></li>
        <li><a href="#3-running运行中">3. Running（运行中）</a></li>
        <li><a href="#4-succeeded成功">4. Succeeded（成功）</a></li>
        <li><a href="#5-failed失败">5. Failed（失败）</a></li>
        <li><a href="#6-unknown未知">6. Unknown（未知）</a></li>
        <li><a href="#7-生命周期钩子lifecycle-hooks">7. 生命周期钩子（Lifecycle Hooks）</a></li>
        <li><a href="#8-健康检查probes">8. 健康检查（Probes）</a></li>
      </ul>
    </li>
    <li><a href="#三pod-的调度">三、Pod 的调度</a>
      <ul>
        <li><a href="#1-调度器的作用">1. 调度器的作用</a></li>
        <li><a href="#2-调度过程">2. 调度过程</a></li>
        <li><a href="#3-调度策略示例">3. 调度策略示例</a></li>
        <li><a href="#4-调度失败处理">4. 调度失败处理</a></li>
      </ul>
    </li>
    <li><a href="#四总结">四、总结</a></li>
  </ul>

  <ul>
    <li><a href="#一controller-概述">一、Controller 概述</a></li>
    <li><a href="#二常见控制器详细解析">二、常见控制器详细解析</a>
      <ul>
        <li><a href="#1deployment">1.Deployment</a></li>
        <li><a href="#2-replicaset">2. ReplicaSet</a></li>
        <li><a href="#3-statefulset">3. StatefulSet</a></li>
        <li><a href="#4-daemonset">4. DaemonSet</a></li>
        <li><a href="#5-job">5. Job</a></li>
        <li><a href="#6-cronjob">6. CronJob</a></li>
      </ul>
    </li>
    <li><a href="#三总结">三、总结</a></li>
  </ul>

  <ul>
    <li><a href="#一service概念">一、Service概念</a></li>
    <li><a href="#二vip和service代理">二、VIP和Service代理</a>
      <ul>
        <li><a href="#1-userspace代理模式">1. Userspace代理模式</a></li>
        <li><a href="#2-iptables代理模式">2. iptables代理模式</a></li>
        <li><a href="#3-ipvs代理模式">3. ipvs代理模式</a></li>
      </ul>
    </li>
    <li><a href="#三service类型">三、Service类型</a></li>
  </ul>
</nav>
    
  </div>
</div>


            
<footer class="flex justify-between items-center gap-2 px-4 py-12">

  <div>
  
 
  

  

  
</div>

  

</footer>

          </div>
        </div>
        <div class="back">
          <div class="container">
            
            <div class="dream-grid dream-grid-about">
  
  
  
  <div class="w-full md:w-1/2 lg:w-1/3 xl:w-1/4 p-4 dream-column">
    <article
      class="card card-compact bg-base-100 hover:bg-base-content/10 shadow-xl dark:border dark:border-base-content/30"
    >
      <div class="card-body">
        <div class="card-title">About Me</div>

        <div class="prose dark:prose-invert">
          <p>没什么想介绍的，一个很大众的全栈码农&hellip;</p>
<p>喜欢代码，车，马，真的是 🐎</p>
<p>讨厌别人让我给自己的代码写文档
最厌烦的是别人的程序没有留下文档</p>

        </div>
      </div>
    </article>
  </div>
  
  <div class="w-full md:w-1/2 lg:w-1/3 xl:w-1/4 p-4 dream-column">
    <article
      class="card card-compact bg-base-100 hover:bg-base-content/10 shadow-xl dark:border dark:border-base-content/30"
    >
      <div class="card-body">
        <div class="card-title">目标</div>

        <div class="prose dark:prose-invert">
          <p>学习 K8S 源码！加油！</p>

        </div>
      </div>
    </article>
  </div>
  
  

  

  
</div>

            

            
<footer class="flex justify-between items-center gap-2 px-4 py-12">

  <div>
  
 
  

  

  
</div>

  

</footer>

          </div>
        </div>
      </div>
    </div>

    <script>
  window.lightTheme = "emerald"
  window.darkTheme =  null 
</script>


  <script src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script>

  
  
    
  
  <script src="/js/grid.min.js"></script>




  

<script src="/js/main.min.js"></script>

    


<script
  src="https://cdn.jsdelivr.net/npm/luxon@1.26.0"
  integrity="sha256-4sbTzmCCW9LGrIh5OsN8V5Pfdad1F1MwhLAOyXKnsE0="
  crossorigin="anonymous"
></script>
<script>
  format()

  function format() {
    document.querySelectorAll('span[data-format="luxon"]').forEach(el => {
      const date = el.textContent

      el.textContent = luxon.DateTime.fromISO(date, { locale: "zh" }).toFormat("yyyy年MM月dd日")
    })
  }
</script>







<script type="module">
  import mediumZoom from 'https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/+esm';
  mediumZoom('#dream-single-post-content img', {
    background: 'oklch(var(--b1))',
    margin: 24,
  })
</script>





    

    

    

    

    <script type="module" src="https://unpkg.com/ionicons@7.4.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.4.0/dist/ionicons/ionicons.js"></script>
  </body>
</html>
