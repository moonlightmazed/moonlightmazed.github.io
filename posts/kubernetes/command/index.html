<!DOCTYPE html>
<html lang="zh-Hans"
  x-data
  :class="$store.darkMode.class()"
  :data-theme="$store.darkMode.theme()">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Command | MoonLightMaze’s Blog</title>

    
  
    <link href="/favicon.ico" rel="icon" type="image/x-icon" />
  


<link rel="canonical" href="https://moonlightmazed.github.io/posts/kubernetes/command/" />



<meta name="author" content="MoonlightMaze" />
<meta name="description" content="Kubernete 命令大全" />


<meta name="keywords" content="Command">



<meta name="generator" content="Hugo 0.145.0">


<meta property="og:url" content="https://moonlightmazed.github.io/posts/kubernetes/command/">
  <meta property="og:site_name" content="MoonLightMaze’s Blog">
  <meta property="og:title" content="Command">
  <meta property="og:description" content="Kubernete 命令大全">
  <meta property="og:locale" content="zh_Hans">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2020-11-02T12:13:02+08:00">
    <meta property="article:modified_time" content="2020-11-02T12:13:02+08:00">
    <meta property="article:tag" content="Command">
    <meta property="og:image" content="https://moonlightmazed.github.io/posts/kubernetes/command/image.png">




  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://moonlightmazed.github.io/posts/kubernetes/command/image.png">
  <meta name="twitter:title" content="Command">
  <meta name="twitter:description" content="Kubernete 命令大全">




  

<link rel="stylesheet" href="/css/output.min.css" />




    


<style>
  pre {
    padding: 1em;
    overflow: auto;
  }
</style>









    

    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  </head>

  <body x-data="{
    flip: false,
  }">
    
    <div id="dream-global-bg"></div>

    
<nav class="mt-4 lg:mt-8 py-4">

  
  <div class="container flex justify-between px-4">
  
    <section class="flex items-center gap-4">
      <div class="avatar cursor-pointer hover:online" @click="flip = !flip" title="翻转一下！">
        <div class="h-10 rounded-full">
          <img src="/img/avatar.png" alt="MoonLightMaze’s Blog" />
        </div>
      </div>

      
      <div>
        
        <a href="https://moonlightmazed.github.io/" class="text-lg font-semibold cursor-pointer">
          MoonLightMaze’s Blog
        </a>
        
        
        <div class="text-base-content/60 text-sm">代码写的越急，程序跑得越慢</div>
        
      </div>
      
    </section>

    <div class="dropdown dropdown-end sm:hidden">
      <div tabindex="0" role="button" class="btn btn-ghost btn-square" aria-label="Select an option">
        <ion-icon name="menu" class="text-2xl"></ion-icon>
      </div>
      <ul tabindex="0" class="dropdown-content menu w-36 bg-base-100 rounded-box z-[1] shadow-md">
        








<li>
  <a class="inline-flex items-center p-2 cursor-pointer" href="/" target="" title="home">
    
    <ion-icon name="home"></ion-icon>
    
    home
  </a>
</li>





<li>
  <a class="inline-flex items-center p-2 cursor-pointer" href="/categories" title="所有分类">
    <ion-icon name="grid"></ion-icon>
    所有分类
  </a>
</li>




<li>
  <a class="inline-flex items-center p-2 cursor-pointer" href="/tags" title="所有标签">
    <ion-icon name="pricetags"></ion-icon>
    所有标签
  </a>
</li>




<li>
  <a class="inline-flex items-center p-2 cursor-pointer" href="/posts" title="归档">
    <ion-icon name="archive"></ion-icon>
    归档
  </a>
</li>




<li>
  <a class="group inline-flex items-center p-2 cursor-pointer" href="/search" title="搜索">
    <ion-icon name="search"></ion-icon>
    搜索
  </a>
</li>








<li>
  <div role="link" tabindex="0" class="inline-flex items-center p-2 cursor-pointer" @click="flip = !flip" title="关于">
    <ion-icon name="information-circle"></ion-icon>关于</div>
</li>










<li>
  <a class="inline-flex items-center p-2 cursor-pointer" href="https://github.com/moonlightmazed" target="_blank" title="GitHub">
    
    <ion-icon name="logo-github"></ion-icon>
    
    GitHub
  </a>
</li>





















      </ul>
    </div>
    <section class="hidden sm:flex sm:items-center sm:gap-2 md:gap-4">
      
      
        
      

      

      
      



  
  <a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="/" target="" title="home">
    <ion-icon class="group-hover:text-primary-content" name="home"></ion-icon>
  </a>
  



      
      
<a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="/categories" title="所有分类">
  <ion-icon class="group-hover:text-primary-content" name="grid"></ion-icon>
</a>


      
      
<a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="/tags" title="所有标签">
  <ion-icon class="group-hover:text-primary-content" name="pricetags"></ion-icon>
</a>


      
      
<a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="/posts" title="归档">
  <ion-icon class="group-hover:text-primary-content" name="archive"></ion-icon>
</a>


      
      
<a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="/search" title="搜索">
  <ion-icon class="group-hover:text-primary-content" name="search"></ion-icon>
</a>


      
      




<div role="link" tabindex="0" class="text-sm font-semibold cursor-pointer hover:underline" @click="flip = !flip" title="关于">关于</div>





      
      



  
  <a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="https://github.com/moonlightmazed" target="_blank" title="GitHub">
    <ion-icon class="group-hover:text-primary-content" name="logo-github"></ion-icon>
  </a>
  



      

      
      












      

      
    </section>
  </div>
</nav>


    <div class="flip-container" :class="{ 'flip-it': flip }">
      <div class="flipper">
        <div class="front">
          <div class="container">
            

<div class="lg:grid lg:grid-cols-5 gap-4 mt-4 px-4">
  
  <div class="lg:col-span-4">
    <article class="mx-auto prose prose-quoteless dark:prose-invert w-full" id="dream-single-post-main" itemscope
      itemtype="http://schema.org/Article" style="margin-right: 30px;max-width: 100% !important;width: 100% !important; ">
      
  <meta itemprop="name" content="Command">
  <meta itemprop="description" content="Kubernete 命令大全">
  <meta itemprop="datePublished" content="2020-11-02T12:13:02+08:00">
  <meta itemprop="dateModified" content="2020-11-02T12:13:02+08:00">
  <meta itemprop="wordCount" content="3084">
  <meta itemprop="image" content="https://moonlightmazed.github.io/posts/kubernetes/command/image.png">
  <meta itemprop="keywords" content="Command">

      <header>
        <h1 itemprop="headline">Command</h1>
        <p class="text-sm">
          
          <span data-format="luxon">2020-11-02T12:13:02&#43;08:00</span>
          

          | <span>7分钟阅读</span>

          
          | <span>更新于
            
            <span data-format="luxon">2020-11-02T12:13:02&#43;08:00</span>
            </span>
          
        </p>

        
        <div class="flex justify-between">
          
          <div class="flex items-center">
  
  <span>@</span>
  

  <span itemprop="author" itemscope itemtype="https://schema.org/Person">
  
    
      <span itemprop="name">MoonlightMaze</span>
    
  
  </span>
</div>

          

          <div class="flex items-center gap-2">
  
  

  
  
  
</div>

        </div>
      </header>

      
      <section id="dream-single-post-content" itemprop="articleBody" class="w-full" style="margin-top: 40px !important;">
        

        <h2 id="集群信息"><strong>集群信息：</strong></h2>
<ol>
<li>显示 Kubernetes 版本：<code>kubectl version</code></li>
<li>显示集群信息：<code>kubectl cluster-info</code></li>
<li>列出集群中的所有节点：<code>kubectl get nodes</code></li>
<li>查看一个具体的节点详情：<code>kubectl describe node &lt;node-name&gt;</code></li>
<li>列出所有命名空间：<code>kubectl get namespaces</code></li>
<li>列出所有命名空间中的所有 pod：<code>kubectl get pods --all-namespaces</code></li>
</ol>
<h2 id="pod-诊断"><strong>Pod 诊断：</strong></h2>
<ol>
<li>列出特定命名空间中的 pod：<code>kubectl get pods -n &lt;namespace&gt;</code></li>
<li>查看一个 Pod 详情：<code>kubectl describe pod &lt;pod-name&gt; -n &lt;namespace&gt;</code></li>
<li>查看 Pod 日志：<code>kubectl logs &lt;pod-name&gt; -n &lt;namespace&gt;</code></li>
<li>尾部 Pod 日志：<code>kubectl logs -f &lt;pod-name&gt; -n &lt;namespace&gt;</code></li>
<li>在 pod 中执行命令：<code>kubectl exec -it &lt;pod-name&gt; -n &lt;namespace&gt; -- &lt;command&gt;</code></li>
</ol>
<h2 id="pod-健康检查"><strong>Pod 健康检查：</strong></h2>
<ol>
<li>检查 Pod 准备情况：<code>kubectl get pods &lt;pod-name&gt; -n &lt;namespace&gt; -o jsonpath='{.status.conditions[?(@.type==&quot;Ready&quot;)].status}'</code></li>
<li>检查 Pod 事件：<code>kubectl get events -n &lt;namespace&gt; --field-selector involvedObject.name=&lt;pod-name&gt;</code></li>
</ol>
<h2 id="service诊断"><strong>Service诊断：</strong></h2>
<ol>
<li>列出命名空间中的所有服务：<code>kubectl get svc -n &lt;namespace&gt;</code></li>
<li>查看一个服务详情：<code>kubectl describe svc &lt;service-name&gt; -n &lt;namespace&gt;</code></li>
</ol>
<h2 id="deployment诊断"><strong>Deployment诊断：</strong></h2>
<ol>
<li>列出命名空间中的所有Deployment：<code>kubectl get deployments -n &lt;namespace&gt;</code></li>
<li>查看一个Deployment详情：<code>kubectl describe deployment &lt;deployment-name&gt; -n &lt;namespace&gt;</code></li>
<li>查看滚动发布状态：<code>kubectl rollout status deployment/&lt;deployment-name&gt; -n &lt;namespace&gt;</code></li>
<li>查看滚动发布历史记录：<code>kubectl rollout history deployment/&lt;deployment-name&gt; -n &lt;namespace&gt;</code></li>
</ol>
<h2 id="statefulset诊断"><strong>StatefulSet诊断：</strong></h2>
<ol>
<li>列出命名空间中的所有 StatefulSet：<code>kubectl get statefulsets -n &lt;namespace&gt;</code></li>
<li>查看一个 StatefulSet详情：<code>kubectl describe statefulset &lt;statefulset-name&gt; -n &lt;namespace&gt;</code></li>
</ol>
<h2 id="configmap-和secret诊断"><strong>ConfigMap 和Secret诊断：</strong></h2>
<ol>
<li>列出命名空间中的 ConfigMap：<code>kubectl get configmaps -n &lt;namespace&gt;</code></li>
<li>查看一个ConfigMap详情：<code>kubectl describe configmap &lt;configmap-name&gt; -n &lt;namespace&gt;</code></li>
<li>列出命名空间中的 Secret：<code>kubectl get secrets -n &lt;namespace&gt;</code></li>
<li>查看一个Secret详情：<code>kubectl describe secret &lt;secret-name&gt; -n &lt;namespace&gt;</code></li>
</ol>
<h2 id="命名空间诊断"><strong>命名空间诊断：</strong></h2>
<ol>
<li>查看一个命名空间详情：<code>kubectl describe namespace &lt;namespace-name&gt;</code></li>
</ol>
<h2 id="资源使用情况"><strong>资源使用情况：</strong></h2>
<ol>
<li>检查 pod 的资源使用情况：<code>kubectl top pod &lt;pod-name&gt; -n &lt;namespace&gt;</code></li>
<li>检查节点资源使用情况：<code>kubectl top nodes</code></li>
</ol>
<h2 id="网络诊断"><strong>网络诊断：</strong></h2>
<ol>
<li>显示命名空间中 Pod 的 IP 地址：<code>kubectl get pods -n &lt;namespace&gt; -o custom-columns=POD:metadata.name,IP:status.podIP --no-headers</code></li>
<li>列出命名空间中的所有网络策略：<code>kubectl get networkpolicies -n &lt;namespace&gt;</code></li>
<li>查看一个网络策略详情：<code>kubectl describe networkpolicy &lt;network-policy-name&gt; -n &lt;namespace&gt;</code></li>
</ol>
<h2 id="持久卷-pv-和持久卷声明-pvc-诊断"><strong>持久卷 (PV) 和持久卷声明 (PVC) 诊断：</strong></h2>
<ol>
<li>列出PV：<code>kubectl get pv</code></li>
<li>查看一个PV详情：<code>kubectl describe pv &lt;pv-name&gt;</code></li>
<li>列出命名空间中的 PVC：<code>kubectl get pvc -n &lt;namespace&gt;</code></li>
<li>查看PVC详情：<code>kubectl describe pvc &lt;pvc-name&gt; -n &lt;namespace&gt;</code></li>
</ol>
<h2 id="节点诊断"><strong>节点诊断：</strong></h2>
<ol>
<li>获取特定节点上运行的 Pod 列表：<code>kubectl get pods --field-selector spec.nodeName=&lt;node-name&gt; -n &lt;namespace&gt;</code></li>
</ol>
<h2 id="资源配额和限制"><strong>资源配额和限制：</strong></h2>
<ol>
<li>列出命名空间中的资源配额：<code>kubectl get resourcequotas -n &lt;namespace&gt;</code></li>
<li>查看一个资源配额详情：<code>kubectl describe resourcequota &lt;resource-quota-name&gt; -n &lt;namespace&gt;</code></li>
</ol>
<h2 id="自定义资源定义-crd-诊断"><strong>自定义资源定义 (CRD) 诊断：</strong></h2>
<ol>
<li>列出命名空间中的自定义资源：<code>kubectl get &lt;custom-resource-name&gt; -n &lt;namespace&gt;</code></li>
<li>查看自定义资源详情：<code>kubectl describe &lt;custom-resource-name&gt; &lt;custom-resource-instance-name&gt; -n &lt;namespace&gt;</code></li>
</ol>
<p>使用这些命令时，请记住将<code>&lt;namespace&gt;</code>, <code>&lt;pod-name&gt;</code>, <code>&lt;service-name&gt;</code>, <code>&lt;deployment-name&gt;</code>, <code>&lt;statefulset-name&gt;</code>, <code>&lt;configmap-name&gt;</code>, <code>&lt;secret-name&gt;</code>, <code>&lt;namespace-name&gt;</code>, <code>&lt;pv-name&gt;</code>, <code>&lt;pvc-name&gt;</code>, <code>&lt;node-name&gt;</code>, <code>&lt;network-policy-name&gt;</code>, <code>&lt;resource-quota-name&gt;</code>, <code>&lt;custom-resource-name&gt;</code>, 和替换为你的特定值。
<code>&lt;custom-resource-instance-name&gt;</code>这些命令应该可以帮助你诊断 Kubernetes 集群以及在其中运行的应用程序。</p>
<h2 id="资源伸缩和自动伸缩"><strong>资源伸缩和自动伸缩</strong></h2>
<ol>
<li>Deployment伸缩：<code>kubectl scale deployment &lt;deployment-name&gt; --replicas=&lt;replica-count&gt; -n &lt;namespace&gt;</code></li>
<li>设置Deployment的自动伸缩：<code>kubectl autoscale deployment &lt;deployment-name&gt; --min=&lt;min-pods&gt; --max=&lt;max-pods&gt; --cpu-percent=&lt;cpu-percent&gt; -n &lt;namespace&gt;</code></li>
<li>检查水平伸缩器状态：<code>kubectl get hpa -n &lt;namespace&gt;</code></li>
</ol>
<h2 id="作业和-cronjob-诊断"><strong>作业和 CronJob 诊断：</strong></h2>
<ol>
<li>列出命名空间中的所有作业：<code>kubectl get jobs -n &lt;namespace&gt;</code></li>
<li>查看一份工作详情：<code>kubectl describe job &lt;job-name&gt; -n &lt;namespace&gt;</code></li>
<li>列出命名空间中的所有 cron 作业：<code>kubectl get cronjobs -n &lt;namespace&gt;</code></li>
<li>查看一个 cron 作业详情：<code>kubectl describe cronjob &lt;cronjob-name&gt; -n &lt;namespace&gt;</code></li>
</ol>
<h2 id="容量诊断"><strong>容量诊断：</strong></h2>
<ol>
<li>列出按容量排序的持久卷 (PV)：<code>kubectl get pv --sort-by=.spec.capacity.storage</code></li>
<li>查看PV回收策略：<code>kubectl get pv &lt;pv-name&gt; -o=jsonpath='{.spec.persistentVolumeReclaimPolicy}'</code></li>
<li>列出所有存储类别：<code>kubectl get storageclasses</code></li>
</ol>
<h2 id="ingress和服务网格诊断"><strong>Ingress和服务网格诊断：</strong></h2>
<ol>
<li>列出命名空间中的所有Ingress：<code>kubectl get ingress -n &lt;namespace&gt;</code></li>
<li>查看一个Ingress详情：<code>kubectl describe ingress &lt;ingress-name&gt; -n &lt;namespace&gt;</code></li>
<li>列出命名空间中的所有 VirtualServices (Istio)：<code>kubectl get virtualservices -n &lt;namespace&gt;</code></li>
<li>查看一个 VirtualService (Istio)详情：<code>kubectl describe virtualservice &lt;virtualservice-name&gt; -n &lt;namespace&gt;</code></li>
</ol>
<h2 id="pod-网络故障排除"><strong>Pod 网络故障排除：</strong></h2>
<ol>
<li>运行网络诊断 Pod（例如 busybox）进行调试：<code>kubectl run -it --rm --restart=Never --image=busybox net-debug-pod -- /bin/sh</code></li>
<li>测试从 Pod 到特定端点的连接：<code>kubectl exec -it &lt;pod-name&gt; -n &lt;namespace&gt; -- curl &lt;endpoint-url&gt;</code></li>
<li>跟踪从一个 Pod 到另一个 Pod 的网络路径：<code>kubectl exec -it &lt;source-pod-name&gt; -n &lt;namespace&gt; -- traceroute &lt;destination-pod-ip&gt;</code></li>
<li>检查 Pod 的 DNS 解析：<code>kubectl exec -it &lt;pod-name&gt; -n &lt;namespace&gt; -- nslookup &lt;domain-name&gt;</code></li>
</ol>
<h2 id="配置和资源验证"><strong>配置和资源验证：</strong></h2>
<ol>
<li>验证 Kubernetes YAML 文件而不应用它：<code>kubectl apply --dry-run=client -f &lt;yaml-file&gt;</code></li>
<li>验证 pod 的安全上下文和功能：<code>kubectl auth can-i list pods --as=system:serviceaccount:&lt;namespace&gt;:&lt;serviceaccount-name&gt;</code></li>
</ol>
<h2 id="rbac-和安全性"><strong>RBAC 和安全性：</strong></h2>
<ol>
<li>列出命名空间中的角色和角色绑定：<code>kubectl get roles,rolebindings -n &lt;namespace&gt;</code></li>
<li>查看角色或角色绑定详情：<code>kubectl describe role &lt;role-name&gt; -n &lt;namespace&gt;</code></li>
</ol>
<h2 id="服务账户诊断"><strong>服务账户诊断：</strong></h2>
<ol>
<li>列出命名空间中的服务帐户：<code>kubectl get serviceaccounts -n &lt;namespace&gt;</code></li>
<li>查看一个服务帐户详情：<code>kubectl describe serviceaccount &lt;serviceaccount-name&gt; -n &lt;namespace&gt;</code></li>
</ol>
<h2 id="清空节点和解除封锁"><strong>清空节点和解除封锁：</strong></h2>
<ol>
<li>清空节点以进行维护：<code>kubectl drain &lt;node-name&gt; --ignore-daemonsets</code></li>
<li>解除对节点的封锁：<code>kubectl uncordon &lt;node-name&gt;</code></li>
</ol>
<h2 id="资源清理"><strong>资源清理：</strong></h2>
<ol>
<li>强制删除 pod（不推荐）：<code>kubectl delete pod &lt;pod-name&gt; -n &lt;namespace&gt; --grace-period=0 --force</code></li>
</ol>
<h2 id="pod-亲和性和反亲和性"><strong>Pod 亲和性和反亲和性：</strong></h2>
<ol>
<li>列出 pod 的 pod 亲和性规则：<code>kubectl get pod &lt;pod-name&gt; -n &lt;namespace&gt; -o=jsonpath='{.spec.affinity}'</code></li>
<li>列出 pod 的 pod 反亲和性规则：<code>kubectl get pod &lt;pod-name&gt; -n &lt;namespace&gt; -o=jsonpath='{.spec.affinity.podAntiAffinity}'</code></li>
</ol>
<h2 id="pod-安全策略-psp"><strong>Pod 安全策略 (PSP)：</strong></h2>
<ol>
<li>列出所有 Pod 安全策略（如果启用）：<code>kubectl get psp</code></li>
</ol>
<h2 id="事件"><strong>事件：</strong></h2>
<ol>
<li>查看最近的集群事件：<code>kubectl get events --sort-by=.metadata.creationTimestamp</code></li>
<li>按特定命名空间过滤事件：<code>kubectl get events -n &lt;namespace&gt;</code></li>
</ol>
<h2 id="节点故障排除"><strong>节点故障排除：</strong></h2>
<ol>
<li>检查节点情况：<code>kubectl describe node &lt;node-name&gt; | grep Conditions -A5</code></li>
<li>列出节点容量和可分配资源：<code>kubectl describe node &lt;node-name&gt; | grep -E &quot;Capacity|Allocatable&quot;</code></li>
</ol>
<h2 id="临时容器kubernetes-118"><strong>临时容器（Kubernetes 1.18+）：</strong></h2>
<ol>
<li>运行临时调试容器：<code>kubectl debug -it &lt;pod-name&gt; -n &lt;namespace&gt; --image=&lt;debug-image&gt; -- /bin/sh</code></li>
</ol>
<h2 id="资源指标需要指标服务器"><strong>资源指标（需要指标服务器）：</strong></h2>
<ol>
<li>获取 Pod 的 CPU 和内存使用情况：<code>kubectl top pod -n &lt;namespace&gt;</code></li>
</ol>
<h2 id="kuelet诊断"><strong>kuelet诊断：</strong></h2>
<ol>
<li>查看节点上的kubelet日志：<code>kubectl logs -n kube-system kubelet-&lt;node-name&gt;</code></li>
</ol>
<h2 id="使用telepresence-进行高级调试"><strong>使用Telepresence 进行高级调试：</strong></h2>
<ol>
<li>使用 Telepresence 调试 pod：<code>telepresence --namespace &lt;namespace&gt; --swap-deployment &lt;pod-name&gt;</code></li>
</ol>
<h2 id="kubeconfig-和上下文"><strong>Kubeconfig 和上下文：</strong></h2>
<ol>
<li>列出可用的上下文：<code>kubectl config get-contexts</code></li>
<li>切换到不同的上下文：<code>kubectl config use-context &lt;context-name&gt;</code></li>
</ol>
<h2 id="pod-安全标准podsecurity-准入控制器"><strong>Pod 安全标准（PodSecurity 准入控制器））：</strong></h2>
<ol>
<li>列出 PodSecurityPolicy (PSP) 违规行为：<code>kubectl get psp -A | grep -vE 'NAME|REVIEWED'</code></li>
</ol>
<h2 id="pod-中断预算-pdb-诊断"><strong>Pod 中断预算 (PDB) 诊断：</strong></h2>
<ol>
<li>列出命名空间中的所有 PDB：<code>kubectl get pdb -n &lt;namespace&gt;</code></li>
<li>查看一个PDB详情：<code>kubectl describe pdb &lt;pdb-name&gt; -n &lt;namespace&gt;</code></li>
</ol>
<h2 id="资源锁诊断如果使用资源锁"><strong>资源锁诊断（如果使用资源锁）：</strong></h2>
<ol>
<li>列出命名空间中的资源锁：<code>kubectl get resourcelocks -n &lt;namespace&gt;</code></li>
</ol>
<h2 id="服务端点和-dns"><strong>服务端点和 DNS：</strong></h2>
<ol>
<li>列出服务的服务端点：<code>kubectl get endpoints &lt;service-name&gt; -n &lt;namespace&gt;</code></li>
<li>检查 Pod 中的 DNS 配置：<code>kubectl exec -it &lt;pod-name&gt; -n &lt;namespace&gt; -- cat /etc/resolv.conf</code></li>
</ol>
<h2 id="自定义指标prometheusgrafana"><strong>自定义指标（Prometheus、Grafana）：</strong></h2>
<ol>
<li>查询Prometheus指标：用于<code>kubectl port-forward</code>访问Prometheus和Grafana服务来查询自定义指标。</li>
</ol>
<h2 id="pod-优先级和抢占"><strong>Pod 优先级和抢占：</strong></h2>
<ol>
<li>列出优先级：<code>kubectl get priorityclasses</code></li>
</ol>
<h2 id="pod-开销kubernetes-118"><strong>Pod 开销（Kubernetes 1.18+）：</strong></h2>
<ol>
<li>列出 pod 中的开销：<code>kubectl get pod &lt;pod-name&gt; -n &lt;namespace&gt; -o=jsonpath='{.spec.overhead}'</code></li>
</ol>
<h2 id="存储卷快照诊断如果使用存储卷快照"><strong>存储卷快照诊断（如果使用存储卷快照）：</strong></h2>
<ol>
<li>列出存储卷快照：<code>kubectl get volumesnapshot -n &lt;namespace&gt;</code></li>
<li>查看存储卷快照详情：<code>kubectl describe volumesnapshot &lt;snapshot-name&gt; -n &lt;namespace&gt;</code></li>
</ol>
<h2 id="资源反序列化诊断"><strong>资源反序列化诊断：</strong></h2>
<ol>
<li>反序列化并打印 Kubernetes 资源：<code>kubectl get &lt;resource-type&gt; &lt;resource-name&gt; -n &lt;namespace&gt; -o=json</code></li>
</ol>
<h2 id="节点污点"><strong>节点污点：</strong></h2>
<ol>
<li>列出节点污点：<code>kubectl describe node &lt;node-name&gt; | grep Taints</code></li>
</ol>
<h2 id="更改和验证-webhook-配置"><strong>更改和验证 Webhook 配置：</strong></h2>
<ol>
<li>列出变异 webhook 配置：<code>kubectl get mutatingwebhookconfigurations</code></li>
<li>列出验证 Webhook 配置：<code>kubectl get validatingwebhookconfigurations</code></li>
</ol>
<h2 id="pod-网络策略"><strong>Pod 网络策略：</strong></h2>
<ol>
<li>列出命名空间中的 pod 网络策略：<code>kubectl get networkpolicies -n &lt;namespace&gt;</code></li>
</ol>
<h2 id="节点条件kubernetes-117"><strong>节点条件（Kubernetes 1.17+）：</strong></h2>
<ol>
<li>自定义查询输出：<code>kubectl get nodes -o custom-columns=NODE:.metadata.name,READY:.status.conditions[?(@.type==&quot;Ready&quot;)].status -l 'node-role.kubernetes.io/worker='</code></li>
</ol>
<h2 id="审核日志"><strong>审核日志：</strong></h2>
<ol>
<li>检索审核日志（如果启用）：检查 Kubernetes 审核日志配置以了解审核日志的位置。</li>
</ol>
<h2 id="节点操作系统详细信息"><strong>节点操作系统详细信息：</strong></h2>
<ol>
<li>获取节点的操作系统信息：<code>kubectl get node &lt;node-name&gt; -o jsonpath='{.status.nodeInfo.osImage}'</code></li>
</ol>
<p>这些命令应该涵盖 Kubernetes 中的各种诊断场景。确保将<code>&lt;namespace&gt;</code>、<code>&lt;pod-name&gt;</code>、<code>&lt;deployment-name&gt;</code>等占位符替换为你的集群和用例的实际值。</p>


        
      </section>

      
      <div class="divider w-full"></div>
      <div class="flex flex-col md:flex-row justify-between gap-4 py-4 w-full">
        
        <a class="group btn btn-outline" href="/posts/cicd/harbor/" title="Harbor">
          <ion-icon name="chevron-back"></ion-icon>
          <div class="inline-flex flex-col items-start">
            <span class="text-base-content/60 group-hover:text-neutral-content/60 text-xs font-normal">上一页</span>
            <span class="max-w-48 truncate">Harbor</span>
          </div>
        </a>
        

        
        <a class="group btn btn-outline" href="/posts/kubernetes/service/" title="Service">
          <div class="inline-flex flex-col items-end">
            <span class="text-base-content/60 group-hover:text-neutral-content/60 text-xs font-normal">下一页</span>
            <span class="max-w-48 truncate">Service</span>
          </div>
          <ion-icon name="chevron-forward"></ion-icon>
        </a>
        
      </div>
      

      
    </article>
  </div>

  
  <div class="hidden lg:flex lg:flex-col lg:items-end lg:col-span-1">
    
    <nav id="TableOfContents">
  <ul>
    <li><a href="#集群信息"><strong>集群信息：</strong></a></li>
    <li><a href="#pod-诊断"><strong>Pod 诊断：</strong></a></li>
    <li><a href="#pod-健康检查"><strong>Pod 健康检查：</strong></a></li>
    <li><a href="#service诊断"><strong>Service诊断：</strong></a></li>
    <li><a href="#deployment诊断"><strong>Deployment诊断：</strong></a></li>
    <li><a href="#statefulset诊断"><strong>StatefulSet诊断：</strong></a></li>
    <li><a href="#configmap-和secret诊断"><strong>ConfigMap 和Secret诊断：</strong></a></li>
    <li><a href="#命名空间诊断"><strong>命名空间诊断：</strong></a></li>
    <li><a href="#资源使用情况"><strong>资源使用情况：</strong></a></li>
    <li><a href="#网络诊断"><strong>网络诊断：</strong></a></li>
    <li><a href="#持久卷-pv-和持久卷声明-pvc-诊断"><strong>持久卷 (PV) 和持久卷声明 (PVC) 诊断：</strong></a></li>
    <li><a href="#节点诊断"><strong>节点诊断：</strong></a></li>
    <li><a href="#资源配额和限制"><strong>资源配额和限制：</strong></a></li>
    <li><a href="#自定义资源定义-crd-诊断"><strong>自定义资源定义 (CRD) 诊断：</strong></a></li>
    <li><a href="#资源伸缩和自动伸缩"><strong>资源伸缩和自动伸缩</strong></a></li>
    <li><a href="#作业和-cronjob-诊断"><strong>作业和 CronJob 诊断：</strong></a></li>
    <li><a href="#容量诊断"><strong>容量诊断：</strong></a></li>
    <li><a href="#ingress和服务网格诊断"><strong>Ingress和服务网格诊断：</strong></a></li>
    <li><a href="#pod-网络故障排除"><strong>Pod 网络故障排除：</strong></a></li>
    <li><a href="#配置和资源验证"><strong>配置和资源验证：</strong></a></li>
    <li><a href="#rbac-和安全性"><strong>RBAC 和安全性：</strong></a></li>
    <li><a href="#服务账户诊断"><strong>服务账户诊断：</strong></a></li>
    <li><a href="#清空节点和解除封锁"><strong>清空节点和解除封锁：</strong></a></li>
    <li><a href="#资源清理"><strong>资源清理：</strong></a></li>
    <li><a href="#pod-亲和性和反亲和性"><strong>Pod 亲和性和反亲和性：</strong></a></li>
    <li><a href="#pod-安全策略-psp"><strong>Pod 安全策略 (PSP)：</strong></a></li>
    <li><a href="#事件"><strong>事件：</strong></a></li>
    <li><a href="#节点故障排除"><strong>节点故障排除：</strong></a></li>
    <li><a href="#临时容器kubernetes-118"><strong>临时容器（Kubernetes 1.18+）：</strong></a></li>
    <li><a href="#资源指标需要指标服务器"><strong>资源指标（需要指标服务器）：</strong></a></li>
    <li><a href="#kuelet诊断"><strong>kuelet诊断：</strong></a></li>
    <li><a href="#使用telepresence-进行高级调试"><strong>使用Telepresence 进行高级调试：</strong></a></li>
    <li><a href="#kubeconfig-和上下文"><strong>Kubeconfig 和上下文：</strong></a></li>
    <li><a href="#pod-安全标准podsecurity-准入控制器"><strong>Pod 安全标准（PodSecurity 准入控制器））：</strong></a></li>
    <li><a href="#pod-中断预算-pdb-诊断"><strong>Pod 中断预算 (PDB) 诊断：</strong></a></li>
    <li><a href="#资源锁诊断如果使用资源锁"><strong>资源锁诊断（如果使用资源锁）：</strong></a></li>
    <li><a href="#服务端点和-dns"><strong>服务端点和 DNS：</strong></a></li>
    <li><a href="#自定义指标prometheusgrafana"><strong>自定义指标（Prometheus、Grafana）：</strong></a></li>
    <li><a href="#pod-优先级和抢占"><strong>Pod 优先级和抢占：</strong></a></li>
    <li><a href="#pod-开销kubernetes-118"><strong>Pod 开销（Kubernetes 1.18+）：</strong></a></li>
    <li><a href="#存储卷快照诊断如果使用存储卷快照"><strong>存储卷快照诊断（如果使用存储卷快照）：</strong></a></li>
    <li><a href="#资源反序列化诊断"><strong>资源反序列化诊断：</strong></a></li>
    <li><a href="#节点污点"><strong>节点污点：</strong></a></li>
    <li><a href="#更改和验证-webhook-配置"><strong>更改和验证 Webhook 配置：</strong></a></li>
    <li><a href="#pod-网络策略"><strong>Pod 网络策略：</strong></a></li>
    <li><a href="#节点条件kubernetes-117"><strong>节点条件（Kubernetes 1.17+）：</strong></a></li>
    <li><a href="#审核日志"><strong>审核日志：</strong></a></li>
    <li><a href="#节点操作系统详细信息"><strong>节点操作系统详细信息：</strong></a></li>
  </ul>
</nav>
    
  </div>
</div>


            
<footer class="flex justify-between items-center gap-2 px-4 py-12">

  <div>
  
 
  

  

  
</div>

  

</footer>

          </div>
        </div>
        <div class="back">
          <div class="container">
            
            <div class="dream-grid dream-grid-about">
  
  
  
  <div class="w-full md:w-1/2 lg:w-1/3 xl:w-1/4 p-4 dream-column">
    <article
      class="card card-compact bg-base-100 hover:bg-base-content/10 shadow-xl dark:border dark:border-base-content/30"
    >
      <div class="card-body">
        <div class="card-title">About Me</div>

        <div class="prose dark:prose-invert">
          <p>没什么想介绍的，一个很大众的全栈码农&hellip;</p>
<p>喜欢代码，车，马，真的是 🐎</p>
<p>讨厌别人让我给自己的代码写文档
最厌烦的是别人的程序没有留下文档</p>

        </div>
      </div>
    </article>
  </div>
  
  <div class="w-full md:w-1/2 lg:w-1/3 xl:w-1/4 p-4 dream-column">
    <article
      class="card card-compact bg-base-100 hover:bg-base-content/10 shadow-xl dark:border dark:border-base-content/30"
    >
      <div class="card-body">
        <div class="card-title">目标</div>

        <div class="prose dark:prose-invert">
          <p>学习 K8S 源码！加油！</p>

        </div>
      </div>
    </article>
  </div>
  
  

  

  
</div>

            

            
<footer class="flex justify-between items-center gap-2 px-4 py-12">

  <div>
  
 
  

  

  
</div>

  

</footer>

          </div>
        </div>
      </div>
    </div>

    <script>
  window.lightTheme = "emerald"
  window.darkTheme =  null 
</script>


  <script src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script>

  
  
    
  
  <script src="/js/grid.min.js"></script>




  

<script src="/js/main.min.js"></script>

    


<script
  src="https://cdn.jsdelivr.net/npm/luxon@1.26.0"
  integrity="sha256-4sbTzmCCW9LGrIh5OsN8V5Pfdad1F1MwhLAOyXKnsE0="
  crossorigin="anonymous"
></script>
<script>
  format()

  function format() {
    document.querySelectorAll('span[data-format="luxon"]').forEach(el => {
      const date = el.textContent

      el.textContent = luxon.DateTime.fromISO(date, { locale: "zh" }).toFormat("yyyy年MM月dd日")
    })
  }
</script>







<script type="module">
  import mediumZoom from 'https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/+esm';
  mediumZoom('#dream-single-post-content img', {
    background: 'oklch(var(--b1))',
    margin: 24,
  })
</script>





    

    

    

    

    <script type="module" src="https://unpkg.com/ionicons@7.4.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.4.0/dist/ionicons/ionicons.js"></script>
  </body>
</html>
